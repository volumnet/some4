-- MySQL dump 10.13  Distrib 8.0.29, for Win64 (x86_64)
--
-- Host: localhost    Database: test
-- ------------------------------------------------------
-- Server version	8.0.29

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `cms_snippets`
--

DROP TABLE IF EXISTS `cms_snippets`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `cms_snippets` (
  `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID#',
  `pid` int unsigned NOT NULL DEFAULT '0' COMMENT 'Parent ID#',
  `post_date` datetime NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT 'Post date',
  `modify_date` datetime NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT 'Modify date',
  `author_id` int unsigned NOT NULL DEFAULT '0' COMMENT 'Author ID#',
  `editor_id` int unsigned NOT NULL DEFAULT '0' COMMENT 'Editor ID#',
  `urn` varchar(255) NOT NULL DEFAULT '' COMMENT 'URN',
  `description` text COMMENT 'Code',
  `locked` tinyint unsigned NOT NULL DEFAULT '0' COMMENT 'Locked',
  PRIMARY KEY (`id`),
  KEY `pid` (`pid`),
  KEY `author_id` (`author_id`),
  KEY `editor_id` (`editor_id`)
) ENGINE=InnoDB AUTO_INCREMENT=63 DEFAULT CHARSET=utf8mb3 COMMENT='Snippets';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `cms_snippets`
--

LOCK TABLES `cms_snippets` WRITE;
/*!40000 ALTER TABLE `cms_snippets` DISABLE KEYS */;
INSERT INTO `cms_snippets` VALUES (1,1,'0000-00-00 00:00:00','2024-04-04 10:06:53',0,1,'__raas_material_interface','<?php\r\n/**\r\n * Стандартный интерфейс материалов\r\n * @param Block_Material $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS;\r\n\r\n$interface = new MaterialInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(2,1,'0000-00-00 00:00:00','2024-04-04 10:06:53',0,1,'__raas_form_interface','<?php\r\n/**\r\n * Стандартный интерфейс формы\r\n * @param Block_Form $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS;\r\n\r\n$interface = new FormInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(3,1,'0000-00-00 00:00:00','2024-04-04 10:06:53',0,1,'__raas_menu_interface','<?php\r\n/**\r\n * Стандартный интерфейс меню\r\n * @param Block_Menu $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS;\r\n\r\n$interface = new MenuInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(4,1,'0000-00-00 00:00:00','2024-04-04 10:06:53',0,1,'__raas_search_interface','<?php\r\n/**\r\n * Стандартный интерфейс поиска\r\n * @param Block_Search $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS;\r\n\r\n$interface = new SearchInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(5,1,'0000-00-00 00:00:00','2024-04-04 10:06:53',0,1,'__raas_form_notify','<?php\r\n/**\r\n * Стандартное уведомление о форме обратной связи\r\n * @param bool $SMS Уведомление отправляется по SMS\r\n * @param Feedback $Item Уведомление формы обратной связи\r\n * @param Material $Material Созданный материал\r\n * @param bool $forUser Отправка сообщения для пользователя\r\n *     (если false то для администратора)\r\n */\r\nnamespace RAAS\\CMS;\r\n\r\nuse RAAS\\Controller_Frontend as ControllerFrontend;\r\n\r\n$cf = ControllerFrontend::i();\r\n$adminUrl = $cf->schemeHost . \'/admin/?p=cms\';\r\n\r\n$form = $Item->parent;\r\n$page = $Item->page;\r\n$material = $Item->material;\r\n\r\nif ($SMS) {\r\n    echo date(DATETIMEFORMAT) . \' \' .\r\n        sprintf(\r\n            FEEDBACK_STANDARD_HEADER,\r\n            $form->name,\r\n            $page->name,\r\n            $cf->idnHost\r\n        ) . \"\\n\" .\r\n        FEEDBACK_ID . \': \' . (int)$Item->id . \"\\n\";\r\n    foreach ($Item->fields as $field) {\r\n        $renderer = NotificationFieldRenderer::spawn($field);\r\n        echo $renderer->render([\'admin\' => !$forUser, \'sms\' => true]);\r\n    }\r\n} else { ?>\r\n    <div>\r\n      <?php echo FEEDBACK_ID . \': \' . (int)$Item->id?>\r\n    </div>\r\n    <div>\r\n      <?php\r\n      if ($forUser) {\r\n          $fields = $Item->visFields;\r\n      } else {\r\n          $fields = $Item->fields;\r\n      }\r\n      foreach ($fields as $field) {\r\n          $renderer = NotificationFieldRenderer::spawn($field);\r\n          echo $renderer->render([\'admin\' => !$forUser, \'sms\' => false]);\r\n      } ?>\r\n    </div>\r\n    <?php if (!$forUser) {\r\n        $url = \'\';\r\n        if ($Material && $Material->id) {\r\n            $url = $cf->schemeHost .\r\n                \'/admin/?p=cms&sub=main&action=edit_material&id=\' .\r\n                (int)$Material->id . \'&pid=\';\r\n            $affectedPagesIds = array_map(function ($x) {\r\n                return $x->id;\r\n            }, (array)$form->Material_Type->affectedPages);\r\n            if (in_array($page->id, $affectedPagesIds)) {\r\n                $url .= $page->id;\r\n            } else {\r\n                $url .= $affectedPagesIds[0];\r\n            }\r\n        } elseif ($form->create_feedback) {\r\n            $url = $cf->schemeHost\r\n                . \'/admin/?p=cms&sub=feedback&action=view&id=\' . $Item->id;\r\n        }\r\n        if ($url) { ?>\r\n            <p>\r\n              <a href=\"<?php echo htmlspecialchars($url)?>\">\r\n                <?php echo VIEW?>\r\n              </a>\r\n            </p>\r\n        <?php } ?>\r\n        <p>\r\n          <small>\r\n            <?php\r\n            echo IP_ADDRESS . \': \' .\r\n                htmlspecialchars((string)$Item->ip) . \'<br />\' .\r\n                USER_AGENT . \': \' .\r\n                htmlspecialchars((string)$Item->user_agent) . \'<br />\' .\r\n                PAGE . \': \';\r\n            if ($page->parents) {\r\n                foreach ($page->parents as $row) { ?>\r\n                    <a href=\"<?php echo htmlspecialchars($adminUrl . \'&id=\' . (int)$row->id)?>\">\r\n                      <?php echo htmlspecialchars($row->name)?>\r\n                    </a> /\r\n                <?php }\r\n            } ?>\r\n            <a href=\"<?php echo htmlspecialchars($adminUrl . \'&id=\' . (int)$page->id)?>\">\r\n              <?php echo htmlspecialchars($page->name)?>\r\n            </a>\r\n            <?php if ($material->id) { ?>\r\n                /\r\n                <a href=\"<?php echo htmlspecialchars($adminUrl . \'&action=edit_material&id=\' . (int)$material->id)?>\">\r\n                  <?php echo htmlspecialchars($material->name)?>\r\n                </a>\r\n            <?php } ?>\r\n            <br />\r\n            <?php echo FORM . \': \';\r\n            if ($form->create_feedback) { ?>\r\n                <a href=\"<?php echo htmlspecialchars($adminUrl . \'&sub=feedback&id=\' . (int)$form->id)?>\">\r\n                  <?php echo htmlspecialchars($form->name)?>\r\n                </a>\r\n            <?php } else {\r\n                echo htmlspecialchars($form->name);\r\n            } ?>\r\n          </small>\r\n        </p>\r\n    <?php }\r\n}\r\n',1),(6,1,'0000-00-00 00:00:00','2024-04-04 10:06:53',0,1,'__raas_cache_interface','<?php\r\n/**\r\n * Стандартный интерфейс кэширования\r\n * @param Block $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n * @param mixed $OUT Данные, полученные от интерфейса блока\r\n */\r\nnamespace RAAS\\CMS;\r\n\r\n$interface = new CacheInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES,\r\n    $OUT\r\n);\r\nreturn $interface->process();\r\n',1),(7,1,'0000-00-00 00:00:00','2024-04-04 10:06:53',0,1,'__raas_watermark_interface','<?php\r\n/**\r\n * Стандартный интерфейс водяных знаков\r\n * @param string[]|null $files Пути файлов для обработки\r\n */\r\nnamespace RAAS\\CMS;\r\n\r\nuse SOME\\Graphics;\r\nuse RAAS\\Application;\r\nuse RAAS\\Attachment;\r\n\r\n$watermark = null;\r\nforeach ([\'design/watermark.png\', \'watermark.png\'] as $tmpWatermark) {\r\n    if (is_file($tmpWatermark = Application::i()->baseDir . \'/files/cms/common/image/\' . $tmpWatermark)) {\r\n        $watermark = $tmpWatermark;\r\n        break;\r\n    }\r\n}\r\nif ($watermark) {\r\n    $interface = new WatermarkInterface($watermark, $_GET, $_POST, $_COOKIE, $_SESSION, $_SERVER, $_FILES);\r\n    $interface->process((array)$files);\r\n}\r\n',1),(8,0,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'dummy','',0),(9,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'banners','<?php\nnamespace RAAS\\CMS;\n\nif ($Set) {\n    ?>\n    <div class=\"banners\">\n      <div id=\"banners<?php echo (int)$Block->id?>\" class=\"carousel slide banners__inner\" data-role=\"slider\" data-slider-carousel=\"bootstrap\" data-slider-autoscroll=\"true\">\n        <?php if (count($Set) > 1) { ?>\n            <ul class=\"carousel-indicators banners__nav\">\n              <?php for ($i = 0; $i < count($Set); $i++) { ?>\n                  <li data-target=\"#banners<?php echo (int)$Block->id?>\" data-slide-to=\"<?php echo (int)$i?>\" class=\"banners__nav-item <?php echo !$i ? \'active\' : \'\'?>\"></li>\n              <?php } ?>\n            </ul>\n        <?php } ?>\n        <div class=\"carousel-inner banners__list banners-list\">\n          <?php for ($i = 0; $i < count($Set); $i++) { $row = $Set[$i]; ?>\n              <div class=\"item <?php echo !$i ? \'active\' : \'\'?> banners-list__item\">\n                <div class=\"banners-item\">\n                  <a class=\"banners-item__image\" <?php echo $row->url ? \'href=\"\' . htmlspecialchars($row->url) . \'\"\' : \'\'?>>\n                    <img src=\"/<?php echo Package::tn($row->image->fileURL, 1920, 654)?>\" alt=\"<?php echo htmlspecialchars($row->image->name ?: $row->name)?>\" />\n                  </a>\n                  <?php if ($row->name[0] != \'.\') { ?>\n                      <div class=\"banners-item__text\">\n                        <div class=\"banners-item__title\">\n                          <?php echo htmlspecialchars($row->name)?>\n                        </div>\n                        <div class=\"banners-item__description\">\n                          <?php echo $row->description?>\n                        </div>\n                      </div>\n                  <?php } ?>\n                </div>\n              </div>\n          <?php } ?>\n        </div>\n        <?php if (count($Set) > 1) { ?>\n            <a href=\"#banners<?php echo (int)$Block->id?>\" data-slide=\"prev\" class=\"left carousel-control banners__arrow banners__arrow_left\"></a>\n            <a href=\"#banners<?php echo (int)$Block->id?>\" data-slide=\"next\" class=\"right carousel-control banners__arrow banners__arrow_right\"></a>\n        <?php } ?>\n      </div>\n    </div>\n<?php } ?>\n',0),(10,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'feedback','<?php\nnamespace RAAS\\CMS;\n\nif ($_POST[\'AJAX\'] && ($Item instanceof Feedback)) {\n    $result = array();\n    if ($success[(int)$Block->id]) {\n        $result[\'success\'] = 1;\n    }\n    if ($localError) {\n        $result[\'localError\'] = $localError;\n    }\n    ob_clean();\n    echo json_encode($result);\n    exit;\n} else { ?>\n    <div class=\"feedback\">\n      <form class=\"form-horizontal\" data-role=\"raas-ajaxform\" action=\"#feedback\" method=\"post\" enctype=\"multipart/form-data\">\n        <?php include Package::i()->resourcesDir . \'/form2.inc.php\'?>\n        <div data-role=\"notifications\" <?php echo ($success[(int)$Block->id] || $localError) ? \'\' : \'style=\"display: none\"\'?>>\n          <div class=\"alert alert-success\" <?php echo ($success[(int)$Block->id]) ? \'\' : \'style=\"display: none\"\'?>><?php echo FEEDBACK_SUCCESSFULLY_SENT?></div>\n          <div class=\"alert alert-danger\" <?php echo ($localError) ? \'\' : \'style=\"display: none\"\'?>>\n            <ul>\n              <?php foreach ((array)$localError as $key => $val) { ?>\n                  <li><?php echo htmlspecialchars($val)?></li>\n              <?php } ?>\n            </ul>\n          </div>\n        </div>\n\n        <div data-role=\"feedback-form\" <?php echo $success[(int)$Block->id] ? \'style=\"display: none\"\' : \'\'?>>\n          <p><?php echo ASTERISK_MARKED_FIELDS_ARE_REQUIRED?></p>\n          <?php if ($Form->signature) { ?>\n                <input type=\"hidden\" name=\"form_signature\" value=\"<?php echo md5(\'form\' . (int)$Form->id . (int)$Block->id)?>\" />\n          <?php } ?>\n          <?php if ($Form->antispam == \'hidden\' && $Form->antispam_field_name) { ?>\n                <input type=\"text\" autocomplete=\"off\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" value=\"<?php echo htmlspecialchars($DATA[$Form->antispam_field_name])?>\" style=\"position: absolute; left: -9999px\" />\n          <?php } ?>\n          <?php foreach ($Form->fields as $row) { ?>\n              <?php if ($row->urn == \'agree\') { ?>\n                  <div class=\"form-group\">\n                    <div class=\"col-sm-9 col-sm-offset-3 col-md-offset-2\">\n                      <label class=\"checkbox\">\n                        <?php $getField($row, $DATA);?>\n                        <a href=\"/privacy/\" target=\"_blank\"><?php echo htmlspecialchars($row->name)?></a>\n                      </label>\n                    </div>\n                  </div>\n              <?php } else { ?>\n                  <div class=\"form-group\">\n                    <label<?php echo !$row->multiple ? \' for=\"\' . htmlspecialchars($row->urn . $row->id . \'_\' . $Block->id) . \'\"\' : \'\'?> class=\"control-label col-sm-3 col-md-2\"><?php echo htmlspecialchars($row->name . ($row->required ? \'*\' : \'\'))?></label>\n                    <div class=\"col-sm-9 col-md-4\">\n                      <?php $getField($row, $DATA);?>\n                    </div>\n                  </div>\n              <?php } ?>\n          <?php } ?>\n          <?php if ($Form->antispam == \'captcha\' && $Form->antispam_field_name) { ?>\n              <div class=\"form-group\">\n                <label for=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" class=\"control-label col-sm-3 col-md-2\"><?php echo CAPTCHA?></label>\n                <div class=\"col-sm-9 col-md-4\">\n                  <img src=\"/assets/kcaptcha/?<?php echo session_name() . \'=\' . session_id()?>\" /><br />\n                  <input type=\"text\" autocomplete=\"off\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" />\n                </div>\n              </div>\n          <?php } ?>\n          <div class=\"form-group\">\n            <div class=\"col-sm-9 col-md-4 col-sm-offset-3 col-md-offset-2\">\n              <button class=\"btn btn-primary\" type=\"submit\"><?php echo SEND?></button>\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n<?php } ?>\n',0),(11,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'feedback_modal','<?php\nnamespace RAAS\\CMS;\n\nif ($_POST[\'AJAX\'] && ($Item instanceof Feedback)) {\n    $result = array();\n    if ($success[(int)$Block->id]) {\n        $result[\'success\'] = 1;\n    }\n    if ($localError) {\n        $result[\'localError\'] = $localError;\n    }\n    ob_clean();\n    echo json_encode($result);\n    exit;\n} else { ?>\n    <!--noindex-->\n    <div class=\"feedback-modal\">\n      <div id=\"<?php echo htmlspecialchars($Widget->urn)?>\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\" class=\"modal fade\">\n        <div class=\"modal-dialog\">\n          <div class=\"modal-content\">\n            <form data-role=\"raas-ajaxform\" action=\"#feedback\" method=\"post\" enctype=\"multipart/form-data\">\n              <div class=\"modal-header\">\n                <button type=\"button\" data-dismiss=\"modal\" aria-hidden=\"true\" class=\"close\">×</button>\n                <div class=\"h4 modal-title\"><?php echo htmlspecialchars($Block->name)?></div>\n              </div>\n              <div class=\"modal-body\">\n                <div class=\"form-horizontal\">\n                  <?php include Package::i()->resourcesDir . \'/form2.inc.php\'?>\n                  <div data-role=\"notifications\" <?php echo ($success[(int)$Block->id] || $localError) ? \'\' : \'style=\"display: none\"\'?>>\n                    <div class=\"alert alert-success\" <?php echo ($success[(int)$Block->id]) ? \'\' : \'style=\"display: none\"\'?>><?php echo FEEDBACK_SUCCESSFULLY_SENT?></div>\n                    <div class=\"alert alert-danger\" <?php echo ($localError) ? \'\' : \'style=\"display: none\"\'?>>\n                      <ul>\n                        <?php foreach ((array)$localError as $key => $val) { ?>\n                            <li><?php echo htmlspecialchars($val)?></li>\n                        <?php } ?>\n                      </ul>\n                    </div>\n                  </div>\n\n                  <div data-role=\"feedback-form\" <?php echo $success[(int)$Block->id] ? \'style=\"display: none\"\' : \'\'?>>\n                    <p><?php echo ASTERISK_MARKED_FIELDS_ARE_REQUIRED?></p>\n                    <?php if ($Form->signature) { ?>\n                          <input type=\"hidden\" name=\"form_signature\" value=\"<?php echo md5(\'form\' . (int)$Form->id . (int)$Block->id)?>\" />\n                    <?php } ?>\n                    <?php if ($Form->antispam == \'hidden\' && $Form->antispam_field_name) { ?>\n                          <input type=\"text\" autocomplete=\"off\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" value=\"<?php echo htmlspecialchars($DATA[$Form->antispam_field_name])?>\" style=\"position: absolute; left: -9999px\" />\n                    <?php } ?>\n                    <?php foreach ($Form->fields as $row) { ?>\n                        <?php if ($row->urn == \'agree\') { ?>\n                            <div class=\"form-group\">\n                              <div class=\"col-sm-9 col-sm-offset-3\">\n                                <label class=\"checkbox\">\n                                  <?php $getField($row, $DATA);?>\n                                  <a href=\"/privacy/\" target=\"_blank\"><?php echo htmlspecialchars($row->name)?></a>\n                                </label>\n                              </div>\n                            </div>\n                        <?php } else { ?>\n                            <div class=\"form-group\">\n                              <label<?php echo !$row->multiple ? \' for=\"\' . htmlspecialchars($row->urn . $row->id . \'_\' . $Block->id) . \'\"\' : \'\'?> class=\"control-label col-sm-3\"><?php echo htmlspecialchars($row->name . ($row->required ? \'*\' : \'\'))?>:</label>\n                              <div class=\"col-sm-9\">\n                                <?php $getField($row, $DATA); ?>\n                              </div>\n                            </div>\n                        <?php } ?>\n                    <?php } ?>\n                    <?php if ($Form->antispam == \'captcha\' && $Form->antispam_field_name) { ?>\n                        <div class=\"form-group\">\n                          <label for=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" class=\"control-label col-sm-3\"><?php echo CAPTCHA?></label>\n                          <div class=\"col-sm-9\">\n                            <img src=\"/assets/kcaptcha/?<?php echo session_name() . \'=\' . session_id()?>\" /><br />\n                            <input type=\"text\" autocomplete=\"off\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" />\n                          </div>\n                        </div>\n                    <?php } ?>\n                    <div class=\"form-group text-right\">\n                      <div class=\"col-sm-12\">\n                        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\"><?php echo CANCEL?></button>\n                        <button class=\"btn btn-primary\" type=\"submit\"><?php echo SEND?></button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!--/noindex-->\n<?php } ?>\n',0),(12,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'head','<?php\nnamespace RAAS\\CMS;\n\nuse SOME\\HTTP;\n\n?>\n<title><?php echo htmlspecialchars($Page->meta_title ? $Page->meta_title : $Page->name)?></title>\n<?php if ($Page->meta_keywords) { ?>\n    <meta name=\"keywords\" content=\"<?php echo htmlspecialchars($Page->meta_keywords)?>\" />\n<?php } ?>\n<?php if ($Page->meta_description) { ?>\n    <meta name=\"description\" content=\"<?php echo htmlspecialchars($Page->meta_description)?>\" />\n<?php } ?>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width\">\n<link rel=\'stylesheet\' href=\'/css/application.css\'>\n<link rel=\'stylesheet\' href=\'/css/animate.css\'>\n<link rel=\'stylesheet\' href=\'/css/style.css\'>\n<link rel=\'stylesheet\' href=\'/custom.css\'>\n<!-- Core-->\n<script src=\"/js/application.js\"></script>\n<script src=\"/js/wow.min.js\"></script>\n<script>new WOW().init();</script>\n<script src=\"/js/jquery.jcarousel.min.js\"></script>\n<script src=\"/js/sliders.js\"></script>\n<script src=\"/js/menu-top.js\"></script>\n<script src=\"/js/setrawcookie.js\"></script>\n<script src=\"/js/setcookie.js\"></script>\n<?php if (class_exists(\'RAAS\\CMS\\Shop\\Module\')) { ?>\n    <script src=\"/js/cookiecart.js\"></script>\n    <script src=\"/js/ajaxcart.js\"></script>\n    <script src=\"/js/ajaxcatalog.js\"></script>\n    <script src=\"/js/modal.js\"></script>\n    <script src=\"/js/catalog.js\"></script>\n<?php } ?>\n<script src=\"/js/script.js\"></script>\n<?php if (is_file(\'favicon.ico\')) { ?>\n    <link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"/favicon.ico\" />\n<?php } ?>\n<?php if (HTTP::queryString()) { ?>\n    <link rel=\"canonical\" href=\"http<?php echo ($_SERVER[\'HTTPS\'] == \'on\' ? \'s\' : \'\')?>://<?php echo htmlspecialchars($_SERVER[\'HTTP_HOST\'] . parse_url($_SERVER[\'REQUEST_URI\'], PHP_URL_PATH))?>\">\n<?php } ?>\n<?php if ($Page->noindex || $Page->Material->noindex) { ?>\n    <meta name=\"robots\" content=\"noindex,nofollow\" />\n<?php } ?>\n',0),(13,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'order_call_modal','<?php\nnamespace RAAS\\CMS;\n\nif ($_POST[\'AJAX\'] && ($Item instanceof Feedback)) {\n    $result = array();\n    if ($success[(int)$Block->id]) {\n        $result[\'success\'] = 1;\n    }\n    if ($localError) {\n        $result[\'localError\'] = $localError;\n    }\n    ob_clean();\n    echo json_encode($result);\n    exit;\n} else { ?>\n    <!--noindex-->\n    <div class=\"order-call-modal\">\n      <div id=\"<?php echo htmlspecialchars($Widget->urn)?>\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\" class=\"modal fade\">\n        <div class=\"modal-dialog\">\n          <div class=\"modal-content\">\n            <form data-role=\"raas-ajaxform\" action=\"#feedback\" method=\"post\" enctype=\"multipart/form-data\">\n              <div class=\"modal-header\">\n                <button type=\"button\" data-dismiss=\"modal\" aria-hidden=\"true\" class=\"close\">×</button>\n                <div class=\"h4 modal-title\"><?php echo ORDER_CALL?></div>\n              </div>\n              <div class=\"modal-body\">\n                <div class=\"form-horizontal\">\n                  <?php include Package::i()->resourcesDir . \'/form.inc.php\'?>\n                  <div data-role=\"notifications\" <?php echo ($success[(int)$Block->id] || $localError) ? \'\' : \'style=\"display: none\"\'?>>\n                    <div class=\"alert alert-success\" <?php echo ($success[(int)$Block->id]) ? \'\' : \'style=\"display: none\"\'?>><?php echo FEEDBACK_SUCCESSFULLY_SENT?></div>\n                    <div class=\"alert alert-danger\" <?php echo ($localError) ? \'\' : \'style=\"display: none\"\'?>>\n                      <ul>\n                        <?php foreach ((array)$localError as $key => $val) { ?>\n                            <li><?php echo htmlspecialchars($val)?></li>\n                        <?php } ?>\n                      </ul>\n                    </div>\n                  </div>\n\n                  <div data-role=\"feedback-form\" <?php echo $success[(int)$Block->id] ? \'style=\"display: none\"\' : \'\'?>>\n                    <?php if ($Form->signature) { ?>\n                          <input type=\"hidden\" name=\"form_signature\" value=\"<?php echo md5(\'form\' . (int)$Form->id . (int)$Block->id)?>\" />\n                    <?php } ?>\n                    <?php if ($Form->antispam == \'hidden\' && $Form->antispam_field_name) { ?>\n                          <input type=\"text\" autocomplete=\"off\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" value=\"<?php echo htmlspecialchars($DATA[$Form->antispam_field_name])?>\" style=\"position: absolute; left: -9999px\" />\n                    <?php } ?>\n                    <?php $row = $Form->fields[\'phone_call\']; $row->placeholder = $row->name; ?>\n                    <div class=\"form-group\">\n                      <div class=\"col-xs-12 order-call__phone\">\n                        <?php $getField($row, $DATA)?>\n                        <button class=\"btn btn-primary\" type=\"submit\"><span class=\"fa fa-phone\"></span></button>\n                      </div>\n                    </div>\n                    <?php $row = $Form->fields[\'agree\'] ?>\n                    <div class=\"form-group\">\n                      <div class=\"col-xs-12\">\n                        <label class=\"checkbox\">\n                          <?php $getField($row, $DATA);?>\n                          <a href=\"/privacy/\" target=\"_blank\"><?php echo htmlspecialchars($row->name)?></a>\n                        </label>\n                      </div>\n                    </div>\n                    <?php if ($Form->antispam == \'captcha\' && $Form->antispam_field_name) { ?>\n                        <div class=\"form-group\">\n                          <label for=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" class=\"control-label col-sm-3\"><?php echo CAPTCHA?></label>\n                          <div class=\"col-sm-9\">\n                            <img src=\"/assets/kcaptcha/?<?php echo session_name() . \'=\' . session_id()?>\" /><br />\n                            <input type=\"text\" autocomplete=\"off\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" />\n                          </div>\n                        </div>\n                    <?php } ?>\n                  </div>\n                </div>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!--/noindex-->\n<?php } ?>\n',0),(14,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'sitemap_xml','<?php\nnamespace RAAS\\CMS;\n\n$getChangeFreq = function($row) {\n    $text = \'\';\n    if ($row->changefreq) {\n        $text .= \'<changefreq>\' . htmlspecialchars($row->changefreq) . \'</changefreq>\';\n    } else {\n        $d0 = max(0, strtotime($row->post_date));\n        $s = ((time() - $d0) / $row->modify_counter);\n        $text .= \'<changefreq>\';\n        if ($s < 1800) {\n            $text .= \'always\';\n        } elseif ($s < 2 * 3600) {\n            $text .= \'hourly\';\n        } elseif ($s < 2 * 86400) {\n            $text .= \'daily\';\n        } elseif ($s < 2 * 7 * 86400) {\n            $text .= \'weekly\';\n        } elseif ($s < 2 * 30 * 86400) {\n            $text .= \'monthly\';\n        } elseif ($s < 2 * 365 * 86400) {\n            $text .= \'yearly\';\n        } else {\n            $text .= \'never\';\n        }\n        $text .= \'</changefreq>\';\n    }\n    return $text;\n};\n\n$showItem = function ($row) use (&$getChangeFreq) {\n    $text = \' <url>\n                <loc>http\' . ($_SERVER[\'HTTPS\'] == \'on\' ? \'s\' : \'\') . \'://\' . htmlspecialchars($_SERVER[\'HTTP_HOST\'] . $row->url) . \'</loc>\';\n    if (strtotime($row->last_modified) > 0) {\n        $text .= \'<lastmod>\' . date(DATE_W3C, strtotime($row->last_modified)) . \'</lastmod>\';\n    }\n    $text .= $getChangeFreq($row);\n    $text .= \'<priority>\' . str_replace(\',\', \'.\', (float)$row->sitemaps_priority) . \'</priority>\';\n    $text .= \'</url>\';\n    return $text;\n};\n\n$showMenu = function(Page $page) use (&$showMenu, &$getChangeFreq, &$showItem) {\n    $children = $page->visChildren;\n    for ($i = 0; $i < count($children); $i++) {\n        $row = $children[$i];\n        if (!$row->response_code) {\n            $text .= $showItem($row);\n            foreach ($row->affectedMaterials as $row2) {\n                if ($row2->parent->id == $row->id) {\n                    $text .= $showItem($row2);\n                }\n            }\n            $text .= $showMenu($row);\n        }\n    }\n    return $text;\n};\n\nheader(\'Content-Type: application/xml; charset=UTF-8\');\necho \'<?xml version=\"1.0\" encoding=\"UTF-8\"?\' . \'>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  \' . $showItem($Page->Domain) . \'\n  \' . $showMenu($Page->Domain) . \'\n</urlset>\';\n',0),(15,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'logo','<?php\nnamespace RAAS\\CMS;\n\n$text = $Block->description;\n$text = str_replace(\' href=\"\' . htmlspecialchars($Page->initialURL) . \'\"\', \'\', $text);\necho $text;\n',0),(16,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'features_main','<?php\nnamespace RAAS\\CMS;\n\nuse \\SOME\\Text;\n\n$translateAddresses = true;\n\nif ($Set) {\n    ?>\n    <div class=\"features-main\">\n      <div class=\"features-main__title h2\"><?php echo htmlspecialchars($Block->name)?></div>\n      <div class=\"features-main__list\">\n        <div class=\"features-main-list\">\n          <?php foreach ($Set as $row) { ?>\n              <div class=\"features-main-list__item\">\n                <div class=\"features-main-item\">\n                  <?php if ($row->image->id || $row->icon) { ?>\n                      <div class=\"features-main-item__image\">\n                        <?php if ($row->image->id) { ?>\n                            <img src=\"/<?php echo htmlspecialchars($row->image->fileURL)?>\" alt=\"<?php echo htmlspecialchars($row->image->name ?: $row->name)?>\" />\n                        <?php } elseif ($row->icon) { ?>\n                            <span class=\"fa fa-<?php echo htmlspecialchars($row->icon)?>\"></span>\n                        <?php } ?>\n                      </div>\n                  <?php } ?>\n                  <div class=\"features-main-item__text\">\n                    <div class=\"features-main-item__title\">\n                      <?php echo htmlspecialchars($row->name)?>\n                    </div>\n                    <div class=\"features-main-item__description\">\n                      <?php echo $row->description?>\n                    </div>\n                  </div>\n                </div>\n              </div>\n          <?php } ?>\n        </div>\n      </div>\n    </div>\n<?php } ?>\n',0),(17,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'robots','<?php\nnamespace RAAS\\CMS;\n\nheader(\'Content-Type: text/plain; charset=UTF-8\');\necho $Block->description;\n',0),(18,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'custom_css','<?php\nnamespace RAAS\\CMS;\n\nheader(\'Content-Type: text/css; charset=UTF-8\');\necho $Block->description;\n',0),(19,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'menu_content','<?php\nnamespace RAAS\\CMS;\n\nuse SOME\\HTTP;\n\n$showMenu = function($node, Page $current) use (&$showMenu) {\n    static $level = 0;\n    if ($node instanceof Menu) {\n        $children = $node->visSubMenu;\n    } else {\n        $children = (isset($node[\'children\']) && is_array($node[\'children\'])) ? $node[\'children\'] : array();\n    }\n    for ($i = 0; $i < count($children); $i++) {\n        $row = $children[$i];\n        $level++;\n        $ch = $showMenu($row, $current);\n        $level--;\n        if ($node instanceof Menu) {\n            $url = $row->url;\n            $name = $row->name;\n        } else {\n            $url = $row[\'url\'];\n            $name = $row[\'name\'];\n        }\n        $active = ($url == HTTP::queryString(\'\', true));\n        $semiactive = preg_match(\'/^\' . preg_quote($url, \'/\') . \'/umi\', HTTP::queryString(\'\', true)) && ($url != \'/\') && !$active;\n        if (preg_match(\'/class=\"[\\\\w\\\\- ]*?active[\\\\w\\\\- ]*?\"/umi\', $ch)) {\n            $semiactive = true;\n        }\n        $liClasses = array(\n            \'menu-content__item\',\n            \'menu-content__item_\' . (!$level ? \'main\' : \'inner\'),\n            \'menu-content__item_level_\' . $level\n        );\n        $aClasses = array(\n            \'menu-content__link\',\n            \'menu-content__link_\' . (!$level ? \'main\' : \'inner\'),\n            \'menu-content__link_level_\' . $level\n        );\n        if ($active) {\n            $liClasses[] = \'menu-content__item_active\';\n            $aClasses[] = \'menu-content__link_active\';\n        } elseif ($semiactive) {\n            $liClasses[] = \'menu-content__item_semiactive\';\n            $aClasses[] = \'menu-content__link_semiactive\';\n        }\n        $text .= \'<li class=\"\' . implode(\' \', $liClasses) . \'\">\'\n              .  \'  <a class=\"\' . implode(\' \', $aClasses) . \'\" \' . ($active ? \'\' : \' href=\"\' . htmlspecialchars($url) . \'\"\') . \'>\' . htmlspecialchars($name) . \'</a>\'\n              .     $ch\n              .  \'</li>\';\n    }\n    $ulClasses = array(\n        \'menu-content__list\',\n        \'menu-content__list_\' . (!$level ? \'main\' : \'inner\'),\n        \'menu-content__list_level_\' . $level\n    );\n    return $text ? \'<ul class=\"\' . implode(\' \', $ulClasses) . \'\">\' . $text . \'</ul>\' : $text;\n};\n\necho \'<nav class=\"menu-content\">\' . $showMenu($menuArr ?: $Item, $Page) . \'</nav>\';\n',0),(20,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'menu_top','<?php\nnamespace RAAS\\CMS;\n\nuse SOME\\HTTP;\n\n$showMenu = function($node, Page $current) use (&$showMenu) {\n    static $level = 0;\n    if ($node instanceof Menu) {\n        $children = $node->visSubMenu;\n    } else {\n        $children = (isset($node[\'children\']) && is_array($node[\'children\'])) ? $node[\'children\'] : array();\n    }\n    for ($i = 0; $i < count($children); $i++) {\n        $row = $children[$i];\n        $level++;\n        $ch = $showMenu($row, $current);\n        $level--;\n        if ($node instanceof Menu) {\n            $url = $row->url;\n            $name = $row->name;\n        } else {\n            $url = $row[\'url\'];\n            $name = $row[\'name\'];\n        }\n        $active = ($url == HTTP::queryString(\'\', true));\n        $semiactive = preg_match(\'/^\' . preg_quote($url, \'/\') . \'/umi\', HTTP::queryString(\'\', true)) && ($url != \'/\') && !$active;\n        if (preg_match(\'/class=\"[\\\\w\\\\- ]*?active[\\\\w\\\\- ]*?\"/umi\', $ch)) {\n            $semiactive = true;\n        }\n        $liClasses = array(\n            \'menu-top__item\',\n            \'menu-top__item_\' . (!$level ? \'main\' : \'inner\'),\n            \'menu-top__item_level_\' . $level\n        );\n        $aClasses = array(\n            \'menu-top__link\',\n            \'menu-top__link_\' . (!$level ? \'main\' : \'inner\'),\n            \'menu-top__link_level_\' . $level\n        );\n        if ($active) {\n            $liClasses[] = \'menu-top__item_active\';\n            $aClasses[] = \'menu-top__link_active\';\n        } elseif ($semiactive) {\n            $liClasses[] = \'menu-top__item_semiactive\';\n            $aClasses[] = \'menu-top__link_semiactive\';\n        }\n        $text .= \'<li class=\"\' . implode(\' \', $liClasses) . \'\">\'\n              .  \'  <a class=\"\' . implode(\' \', $aClasses) . \'\" \' . ($active ? \'\' : \' href=\"\' . htmlspecialchars($url) . \'\"\') . \'>\' . htmlspecialchars($name) . \'</a>\'\n              .     $ch\n              .  \'</li>\';\n    }\n    $ulClasses = array(\n        \'menu-top__list\',\n        \'menu-top__list_\' . (!$level ? \'main\' : \'inner\'),\n        \'menu-top__list_level_\' . $level\n    );\n    return $text ? \'<ul class=\"\' . implode(\' \', $ulClasses) . \'\">\' . $text . \'</ul>\' : $text;\n};\n\necho \'<nav class=\"menu-top\">\' . $showMenu($menuArr ?: $Item, $Page) . \'</nav>\';\n',0),(21,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'menu_bottom','<?php\nnamespace RAAS\\CMS;\n\nuse SOME\\HTTP;\n\n$showMenu = function($node, Page $current) use (&$showMenu) {\n    static $level = 0;\n    if ($node instanceof Menu) {\n        $children = $node->visSubMenu;\n    } else {\n        $children = (isset($node[\'children\']) && is_array($node[\'children\'])) ? $node[\'children\'] : array();\n    }\n    for ($i = 0; $i < count($children); $i++) {\n        $row = $children[$i];\n        $level++;\n        $ch = $showMenu($row, $current);\n        $level--;\n        if ($node instanceof Menu) {\n            $url = $row->url;\n            $name = $row->name;\n        } else {\n            $url = $row[\'url\'];\n            $name = $row[\'name\'];\n        }\n        $active = ($url == HTTP::queryString(\'\', true));\n        $semiactive = preg_match(\'/^\' . preg_quote($url, \'/\') . \'/umi\', HTTP::queryString(\'\', true)) && ($url != \'/\') && !$active;\n        if (preg_match(\'/class=\"[\\\\w\\\\- ]*?active[\\\\w\\\\- ]*?\"/umi\', $ch)) {\n            $semiactive = true;\n        }\n        $liClasses = array(\n            \'menu-bottom__item\',\n            \'menu-bottom__item_\' . (!$level ? \'main\' : \'inner\'),\n            \'menu-bottom__item_level_\' . $level\n        );\n        $aClasses = array(\n            \'menu-bottom__link\',\n            \'menu-bottom__link_\' . (!$level ? \'main\' : \'inner\'),\n            \'menu-bottom__link_level_\' . $level\n        );\n        if ($active) {\n            $liClasses[] = \'menu-bottom__item_active\';\n            $aClasses[] = \'menu-bottom__link_active\';\n        } elseif ($semiactive) {\n            $liClasses[] = \'menu-bottom__item_semiactive\';\n            $aClasses[] = \'menu-bottom__link_semiactive\';\n        }\n        $text .= \'<li class=\"\' . implode(\' \', $liClasses) . \'\">\'\n              .  \'  <a class=\"\' . implode(\' \', $aClasses) . \'\" \' . ($active ? \'\' : \' href=\"\' . htmlspecialchars($url) . \'\"\') . \'>\' . htmlspecialchars($name) . \'</a>\'\n              .     $ch\n              .  \'</li>\';\n    }\n    $ulClasses = array(\n        \'menu-bottom__list\',\n        \'menu-bottom__list_\' . (!$level ? \'main\' : \'inner\'),\n        \'menu-bottom__list_level_\' . $level\n    );\n    return $text ? \'<ul class=\"\' . implode(\' \', $ulClasses) . \'\">\' . $text . \'</ul>\' : $text;\n};\n\necho \'<nav class=\"menu-bottom\">\' . $showMenu($menuArr ?: $Item, $Page) . \'</nav>\';\n',0),(22,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'news','<?php\nnamespace RAAS\\CMS;\n\nuse \\SOME\\Text;\nuse \\SOME\\HTTP;\n\nif ($Item) {\n    ?>\n    <div class=\"news\">\n      <div class=\"news-article\">\n        <?php if (($t = strtotime($Item->date)) > 0) { ?>\n            <div class=\"news-article__date\"><?php echo date(\'d\', $t) . \' \' . Text::$months[(int)date(\'m\', $t)] . \' \' . date(\'Y\', $t)?></div>\n        <?php } ?>\n        <?php if ($Item->visImages) { ?>\n            <div class=\"news-article__image\">\n              <a href=\"/<?php echo $Item->visImages[0]->fileURL?>\" data-lightbox-gallery=\"g\">\n                <img src=\"/<?php echo $Item->visImages[0]->tnURL?>\" alt=\"<?php echo htmlspecialchars($Item->visImages[0]->name ?: $row->name)?>\" /></a>\n            </div>\n        <?php } ?>\n        <div class=\"news-article__text\">\n          <div class=\"news-article__description\">\n            <?php echo $Item->description?>\n          </div>\n        </div>\n        <?php if (count($Item->visImages) > 1) { ?>\n            <div class=\"news-article__images\">\n              <div class=\"h2 news-article__images-title\">\n                Фотографии\n              </div>\n              <div class=\"news-article__images-inner\">\n                <?php for ($i = 1; $i < count($Item->visImages); $i++) { $row = $Item->visImages[$i]; ?>\n                    <div class=\"news-article__additional-image-container\">\n                      <a href=\"/<?php echo htmlspecialchars($row->fileURL)?>\" class=\"news-article__additional-image\" data-lightbox-gallery=\"g\">\n                        <img src=\"/<?php echo htmlspecialchars($row->tnURL)?>\" alt=\"<?php echo htmlspecialchars($row->name)?>\" /></a>\n                    </div>\n                <?php } ?>\n              </div>\n            </div>\n        <?php } ?>\n      </div>\n    </div>\n<?php } elseif ($Set) { ?>\n    <div class=\"news\">\n      <div class=\"news__list\">\n        <div class=\"news-list\">\n          <?php foreach ($Set as $row) { ?>\n              <div class=\"news-list__item\">\n                <div class=\"news-item\">\n                  <div class=\"news-item__image\">\n                    <a<?php echo ($Block->nat ? \' href=\"\' . htmlspecialchars($row->url) . \'\"\' : \'\') . (!$row->visImages ? \' class=\"no-image\"\' : \'\')?>>\n                      <?php if ($row->visImages) { ?>\n                          <img src=\"/<?php echo htmlspecialchars($row->visImages[0]->tnURL)?>\" alt=\"<?php echo htmlspecialchars($row->visImages[0]->name ?: $row->name)?>\" />\n                      <?php } ?>\n                    </a>\n                  </div>\n                  <div class=\"news-item__text\">\n                    <div class=\"news-item__title\">\n                      <a<?php echo $Block->nat ? \' href=\"\' . htmlspecialchars($row->url) . \'\"\' : \'\'?>>\n                        <?php echo htmlspecialchars($row->name)?>\n                      </a>\n                    </div>\n                    <?php if (($t = strtotime($row->date)) > 0) { ?>\n                        <div class=\"news-item__date\">\n                          <?php echo date(\'d\', $t) . \' \' . Text::$months[(int)date(\'m\', $t)] . \' \' . date(\'Y\', $t)?>\n                        </div>\n                    <?php } ?>\n                    <div class=\"news-item__description\">\n                      <?php echo htmlspecialchars($row->brief ?: Text::cuttext(html_entity_decode(strip_tags($row->description), ENT_COMPAT | ENT_HTML5, \'UTF-8\'), 256, \'...\'))?>\n                    </div>\n                    <?php if ($Block->nat) { ?>\n                        <div class=\"news-item__more\">\n                          <a href=\"<?php echo htmlspecialchars($row->url)?>\">\n                            <?php echo SHOW_MORE?>\n                          </a>\n                        </div>\n                    <?php } ?>\n                  </div>\n                </div>\n              </div>\n          <?php } ?>\n        </div>\n      </div>\n    </div>\n    <?php include Package::i()->resourcesDir . \'/pages.inc.php\'?>\n    <?php if ($Pages->pages > 1) { ?>\n        <ul class=\"pagination pull-right\">\n          <?php\n          echo $outputNav(\n              $Pages,\n              array(\n                  \'pattern\' => \'<li><a href=\"\' . HTTP::queryString(\'page={link}\') . \'\">{text}</a></li>\',\n                  \'pattern_active\' => \'<li class=\"active\"><a>{text}</a></li>\',\n                  \'ellipse\' => \'<li class=\"disabled\"><a>...</a></li>\'\n              )\n          );\n          ?>\n        </ul>\n    <?php } ?>\n<?php } ?>\n',0),(23,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'news_main','<?php\nnamespace RAAS\\CMS;\n\nuse \\SOME\\Text;\n\n$translateAddresses = true;\n\nif ($Set) {\n    ?>\n    <div class=\"news-main left-block\">\n      <div class=\"news-main__title left-block__title\"><a href=\"/news/\">Новости</a></div>\n      <div class=\"news-main__list left-block__inner\">\n        <div class=\"news-main-list\">\n          <?php foreach ($Set as $row) { ?>\n              <div class=\"news-main-list__item\">\n                <div class=\"news-main-item\">\n                  <div class=\"news-main-item__image\">\n                    <a<?php echo ($translateAddresses ? \' href=\"\' . htmlspecialchars($row->url) . \'\"\' : \'\') . (!$row->visImages ? \' class=\"no-image\"\' : \'\')?>>\n                      <?php if ($row->visImages) { ?>\n                          <img src=\"/<?php echo Package::tn($row->visImages[0]->fileURL, 1920, 654)?>\" alt=\"<?php echo htmlspecialchars($row->visImages[0]->name ?: $row->name)?>\" />\n                      <?php } ?>\n                    </a>\n                  </div>\n                  <div class=\"news-main-item__text\">\n                    <div class=\"news-main-item__title\">\n                      <a<?php echo $translateAddresses ? \' href=\"\' . htmlspecialchars($row->url) . \'\"\' : \'\'?>>\n                        <?php echo htmlspecialchars($row->name)?>\n                      </a>\n                    </div>\n                    <?php if (($t = strtotime($row->date)) > 0) { ?>\n                        <div class=\"news-main-item__date\">\n                          <?php echo date(\'d\', $t) . \' \' . Text::$months[(int)date(\'m\', $t)] . \' \' . date(\'Y\', $t)?>\n                        </div>\n                    <?php } ?>\n                    <div class=\"news-main-item__description\">\n                      <?php echo htmlspecialchars($row->brief ?: Text::cuttext(html_entity_decode(strip_tags($row->description), ENT_COMPAT | ENT_HTML5, \'UTF-8\'), 256, \'...\'))?>\n                    </div>\n                    <?php if ($translateAddresses) { ?>\n                        <div class=\"news-main-item__more\">\n                          <a href=\"<?php echo htmlspecialchars($row->url)?>\">\n                            <?php echo SHOW_MORE?>\n                          </a>\n                        </div>\n                    <?php } ?>\n                  </div>\n                </div>\n              </div>\n          <?php } ?>\n        </div>\n      </div>\n    </div>\n<?php } ?>\n',0),(24,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'__raas_shop_cart_interface','<?php\n/**\n * Стандартный интерфейс корзины\n * @param Block_Cart $Block Текущий блок\n * @param Page $Page Текущая страница\n */\nnamespace RAAS\\CMS\\Shop;\n\n$interface = new CartInterface(\n    $Block,\n    $Page,\n    $_GET,\n    $_POST,\n    $_COOKIE,\n    $_SESSION,\n    $_SERVER,\n    $_FILES\n);\nreturn $interface->process();\n',1),(25,1,'0000-00-00 00:00:00','2024-04-04 10:06:56',0,1,'__raas_shop_order_notify','<?php\n/**\n * Стандартное уведомление о заказе\n * @param bool $SMS Уведомление отправляется по SMS\n * @param Order $Item Уведомление формы обратной связи\n * @param bool $forUser Отправка сообщения для пользователя\n *     (если false то для администратора)\n */\nnamespace RAAS\\CMS\\Shop;\n\nuse SOME\\Text;\nuse RAAS\\Controller_Frontend as ControllerFrontend;\nuse RAAS\\CMS\\DiagTimer;\nuse RAAS\\CMS\\Form_Field;\nuse RAAS\\CMS\\NotificationFieldRenderer;\n\n$cf = ControllerFrontend::i();\n$adminUrl = $cf->schemeHost . \'/admin/?p=cms\';\n\n$page = $Item->page;\n$cartType = $Item->parent;\n\nif ($SMS) {\n    if ($forUser) {\n        echo sprintf(ORDER_SUCCESSFULLY_SENT, $Item->id);\n    } else {\n        echo date(DATETIMEFORMAT) . \' \' .\n            sprintf(ORDER_STANDARD_HEADER_USER, $Item->id, $cf->idnHost) . \"\\n\";\n        foreach ($Item->fields as $field) {\n            $renderer = NotificationFieldRenderer::spawn($field);\n            echo $renderer->render([\'admin\' => !$forUser, \'sms\' => true]);\n        }\n    }\n} else { ?>\n    <div>\n      <?php echo ORDER_ID . \': \' . (int)$Item->id?>\n    </div>\n    <div>\n      <?php\n      if ($forUser) {\n          $fields = $Item->visFields;\n      } else {\n          $fields = $Item->fields;\n      }\n      foreach ($fields as $field) {\n          $renderer = NotificationFieldRenderer::spawn($field);\n          echo $renderer->render([\'admin\' => !$forUser, \'sms\' => false]);\n      }\n      ?>\n    </div>\n    <?php if ($Item->items) { ?>\n        <br />\n        <table style=\"width: 100%\" border=\"1\">\n          <thead>\n            <tr>\n              <th><?php echo NAME?></th>\n              <th><?php echo ADDITIONAL_INFO?></th>\n              <th><?php echo PRICE?></th>\n              <th><?php echo AMOUNT?></th>\n              <th><?php echo SUM?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $sum = 0;\n            foreach ($Item->items as $item) {\n                $url = \'\';\n                if (($item->id && !$forUser) || $item->url) {\n                    if ($forUser) {\n                        $url = $cf->schemeHost . $item->url;\n                    } elseif ($item->id) {\n                        $url = $cf->schemeHost\n                            . \'/admin/?p=cms&sub=main&action=edit_material&id=\'\n                            . $item->id;\n                        if ($item->cache_url_parent_id) {\n                            // 2023-04-12, AVS: переписал на cache_url_parent_id (было через affectedPages) -\n                            // при большом количестве товаров дико тормозило (до 3 секунд на позицию)\n                            $url .= \'&pid=\' . (int)$item->cache_url_parent_id;\n                        }\n                    }\n                }\n                $itemSum = $item->amount * $item->realprice;\n                $sum += $itemSum;\n                ?>\n                <tr>\n                  <td>\n                    <?php if ($url) { ?>\n                        <a href=\"<?php echo htmlspecialchars($url)?>\">\n                          <?php echo htmlspecialchars($item->name)?>\n                        </a>\n                    <?php } else {\n                        echo htmlspecialchars($item->name);\n                    } ?>\n                  </td>\n                  <td>\n                    <?php echo htmlspecialchars($item->__get(\'meta\'))?>&nbsp;\n                  </td>\n                  <td style=\"text-align: right; white-space: nowrap;\">\n                    <?php echo Text::formatPrice($item->realprice)?>\n                  </td>\n                  <td>\n                    <?php echo (int)$item->amount?>\n                  </td>\n                  <td style=\"text-align: right; white-space: nowrap;\">\n                    <?php echo Text::formatPrice($itemSum)?>\n                  </td>\n                </tr>\n            <?php } ?>\n            <tr>\n              <th colspan=\"4\" style=\"text-align: right\">\n                <?php echo TOTAL_SUM?>:\n              </th>\n              <th style=\"text-align: right; white-space: nowrap;\">\n                <?php echo Text::formatPrice($sum)?>\n              </th>\n            </tr>\n          </tbody>\n        </table>\n    <?php }\n    if (!$forUser) { ?>\n        <p>\n          <a href=\"<?php echo htmlspecialchars($adminUrl . \'&m=shop&sub=orders&action=view&id=\' . (int)$Item->id)?>\">\n            <?php echo VIEW?>\n          </a>\n        </p>\n        <p>\n          <small>\n            <?php\n            echo IP_ADDRESS . \': \' .\n                htmlspecialchars((string)$Item->ip) . \'<br />\' .\n                USER_AGENT . \': \' .\n                htmlspecialchars((string)$Item->user_agent) . \'<br />\' .\n                PAGE . \': \';\n            if ($page->parents) {\n                foreach ($page->parents as $row) { ?>\n                    <a href=\"<?php echo htmlspecialchars($adminUrl . \'&id=\' . (int)$row->id)?>\">\n                      <?php echo htmlspecialchars($row->name)?>\n                    </a> /\n                <?php }\n            } ?>\n            <a href=\"<?php echo htmlspecialchars($adminUrl . \'&id=\' . (int)$page->id)?>\">\n              <?php echo htmlspecialchars($page->name)?>\n            </a>\n            <br />\n            <?php echo CART_TYPE?>:\n            <a href=\"<?php echo htmlspecialchars($adminUrl . \'&m=shop&sub=orders&id=\' . (int)$cartType->id)?>\">\n              <?php echo htmlspecialchars($cartType->name)?>\n            </a>\n          </small>\n        </p>\n    <?php }\n}\n',1),(26,1,'0000-00-00 00:00:00','2024-04-04 10:06:56',0,1,'__raas_shop_imageloader_interface','<?php\n/**\n * Интерфейс загрузчика изображений\n * @param ImageLoader $Loader Загрук\n */\nnamespace RAAS\\CMS\\Shop;\n\nuse RAAS\\Application;\nuse RAAS\\Attachment;\nuse RAAS\\CMS\\Material;\nuse RAAS\\CMS\\Package;\nuse RAAS\\CMS\\Sub_Main as Package_Sub_Main;\n\n$interface = new ImageloaderInterface($Loader);\nif ($_SERVER[\'REQUEST_METHOD\'] == \'POST\') {\n    return $interface->upload($files, $test, $clear);\n} else {\n    return $interface->download();\n}\n',1),(27,1,'0000-00-00 00:00:00','2024-04-04 10:06:56',0,1,'__raas_shop_priceloader_interface','<?php\r\n/**\r\n * Сниппет интерфейса загрузчика прайсов\r\n * @param PriceLoader $Loader Загрузчик прайсов\r\n * @param Page $Page Страница, в которую загружаем\r\n * @param int $rows Сколько строк отступать\r\n * @param int $cols Сколько колонок отступать\r\n * @param array|null $file <pre><code>[\r\n *     \'tmp_name\' => string путь к файлу,\r\n *     \'name\' => string Имя файла\r\n * ]|null</code></pre> загружаемый файл\r\n * @param bool $test Тестовый режим\r\n * @param int $clear Очищать старые материалы и/или страницы (константа из PriceLoader::DELETE_PREVIOUS_MATERIALS_...)\r\n * @param string $type <pre><code>\'csv\'|\'xls\'|\'xlsx\'</code></pre> Формат, в котором выгружаем\r\n * @param string $encoding Кодировка для формата CSV, в которой выгружаем (совместимо с iconv)\r\n */\r\nnamespace RAAS\\CMS\\Shop;\r\n\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new PriceloaderInterface($Loader);\r\nif ($_SERVER[\'REQUEST_METHOD\'] == \'POST\') {\r\n    $type = strtolower(pathinfo($file[\'name\'], PATHINFO_EXTENSION));\r\n    return $interface->upload(\r\n        $file[\'tmp_name\'],\r\n        $type,\r\n        $Page,\r\n        $test,\r\n        $clear,\r\n        $rows,\r\n        $cols\r\n    );\r\n} else {\r\n    return $interface->download($Page, $rows, $cols, $type, $encoding);\r\n}\r\n',1),(28,1,'0000-00-00 00:00:00','2024-04-04 10:06:56',0,1,'__raas_shop_yml_interface','<?php\r\n/**\r\n * Сниппет интерфейса Яндекс.Маркета\r\n * @param Block_YML $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS\\Shop;\r\n\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new YMLInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER\r\n);\r\n$interface->process(true, 300);\r\n',1),(29,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'__raas_robokassa_interface','<?php\nnamespace RAAS\\CMS\\Shop;\n\nuse RAAS\\CMS\\Snippet;\nuse RAAS\\Application;\n\nif (in_array($_GET[\'action\'], array(\'result\', \'success\', \'fail\')) && $_REQUEST[\'InvId\']) {\n    // Подписанное значение - либо RESULT URL, либо SUCCESS URL, либо FAIL URL\n    $inv_id = $_REQUEST[\'InvId\'];\n    $Item = new Order($inv_id);\n    $crc = isset($_REQUEST[\'SignatureValue\']) ? strtoupper($_REQUEST[\'SignatureValue\']) : null;\n    switch ($_GET[\'action\']) {\n        case \'result\':\n            while (ob_get_level()) {\n                ob_end_clean();\n            }\n            $my_crc = strtoupper(md5($_REQUEST[\'OutSum\'] . \':\' . $inv_id . \':\' . $Block->epay_pass2));\n            if ($my_crc != $crc) {\n                echo \'Invalid signature\';\n            } elseif (!$Item->id) {\n                echo \'Invalid order ID#\';\n            } else {\n                // Все ок\n                $history = new Order_History();\n                $history->uid = Application::i()->user->id;\n                $history->order_id = (int)$Item->id;\n                $history->status_id = (int)$Item->status_id;\n                $history->paid = 1;\n                $history->post_date = date(\'Y-m-d H:i:s\');\n                $history->description = PAID_VIA_ROBOKASSA;\n                $history->commit();\n\n                $Item->paid = 1;\n                $Item->commit();\n                echo \'OK\' . (int)$Item->id;\n            }\n            exit;\n            break;\n        case \'success\':\n            $my_crc = strtoupper(md5($_REQUEST[\'OutSum\'] . \':\' . $inv_id . \':\' . $Block->epay_pass1));\n            if ($Item->id) {\n                $OUT[\'epayWidget\'] = Snippet::importByURN(\'robokassa\');\n                $OUT[\'Item\'] = $Item;\n                if ($crc == $my_crc) {\n                    $OUT[\'success\'][(int)$Block->id] = sprintf(ORDER_SUCCESSFULLY_PAID, $Item->id);\n                } else {\n                    $OUT[\'localError\'] = array(\'crc\' => INVALID_CRC);\n                }\n            }\n            break;\n        case \'fail\':\n            if ($Item->id) {\n                $OUT[\'epayWidget\'] = Snippet::importByURN(\'robokassa\');\n                $OUT[\'Item\'] = $Item;\n                $OUT[\'localError\'] = array(\'order\' => sprintf(ORDER_HAS_NOT_BEEN_PAID, $Item->id));\n            }\n            break;\n    }\n} elseif ($Item->id && $_POST[\'epay\']) {\n    $OUT[\'epayWidget\'] = Snippet::importByURN(\'robokassa\');\n    $OUT[\'paymentURL\'] = $Block->epay_test ? \'https://auth.robokassa.ru/Merchant/Index.aspx?IsTest=1\' : \'https://auth.robokassa.ru/Merchant/Index.aspx\';\n    $OUT[\'requestForPayment\'] = true;\n    $crc = $Block->epay_login . \':\' . number_format($Item->sum, 2, \'.\', \'\') . \':\' . (int)$Item->id;\n    if (!$Block->epay_test && $Block->epay_currency && ($Block->epay_currency != \'RUR\')) {\n        $crc .= \':\' . $Block->epay_currency;\n    }\n    $crc .= \':\' . $Block->epay_pass1;\n    $crc = md5($crc);\n    $OUT[\'crc\'] = $crc;\n}\n',1),(30,1,'0000-00-00 00:00:00','2024-04-04 10:06:56',0,1,'__raas_my_orders_interface','<?php\r\n/**\r\n * Стандартный интерфейс сервиса \"Мои заказы\"\r\n * @param Block_PHP $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS\\Shop;\r\n\r\nuse RAAS\\CMS\\Block_PHP;\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new MyOrdersInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(31,1,'0000-00-00 00:00:00','2024-04-04 10:06:56',0,1,'catalog_interface','<?php\nnamespace RAAS\\CMS;\n\n$IN = (array)$_GET;\nparse_str(trim($Block->params), $temp);\n$IN = array_merge($IN, (array)$temp);\n\n$OUT = array();\nif ($Page->Material && $Block->nat) {\n    $Item = $Page->Material;\n    if ($Page->initialURL != $Item->url) {\n        // Адреса не совпадают\n        if ((int)$Block->legacy && ($Item->pid == $Block->material_type)) {\n            // Установлена переадресация\n            header(\"HTTP/1.1 301 Moved Permanently\");\n            header(\'Location: http\' . ($_SERVER[\'HTTPS\'] == \'on\' ? \'s\' : \'\') . \'://\' . $_SERVER[\'HTTP_HOST\'] . $Item->url);\n            exit;\n        } else {\n            return;\n        }\n    }\n    $OUT[\'Item\'] = $Item;\n\n    // Отзывы\n    // $commentsMType = Material_Type::importByURN(\'goods_comments\');\n    // $commentMaterialField = $commentsMType->fields[\'material\'];\n    // $SQL_query = \"SELECT tM.*\n    //                 FROM \" . Material::_tablename() . \" AS tM\n    //                 JOIN cms_data AS tD ON tD.fid = \" . (int)$commentMaterialField->id . \" AND tD.pid = tM.id\n    //                WHERE tM.pid = \" . (int)$commentsMType->id . \" AND tM.vis AND tD.value = \" . (int)$Page->Material->id\n    //            . \" ORDER BY tM.post_date DESC\";\n    // $comments = Material::getSQLSet($SQL_query);\n    // $OUT[\'comments\'] = $comments;\n    // $OUT[\'commentFormBlock\'] = Block::spawn(71);\n\n    foreach (array(\'name\', \'meta_title\', \'meta_keywords\', \'meta_description\', \'h1\') as $key) {\n        $Page->{\'old\' . ucfirst($key)} = $Page->$key;\n        $Page->$key = $Item->$key;\n    }\n    $Item->proceed = true;\n    $_SESSION[\'visited\'] = (array)$_SESSION[\'visited\'];\n    $_SESSION[\'visited\'][] = (int)$Item->id;\n    $_SESSION[\'visited\'] = array_unique($_SESSION[\'visited\']);\n    $_SESSION[\'visited\'] = array_filter($_SESSION[\'visited\']);\n    $_SESSION[\'visited\'] = array_values($_SESSION[\'visited\']);\n} else {\n    $MType = new Material_Type($Block->material_type);\n    $cc = new Catalog_Cache($MType);\n    if (!$cc->load()) {\n        $cc->getCache();\n        $cc->save();\n    }\n    $Set = $cc->data;\n\n    if (!$MType->global_type) {\n        if ($Page->pid) {\n            $pages_ids = array_merge(array((int)$Page->id), (array)$Page->all_children_ids);\n        } else {\n            $pages_ids = array($Page->id);\n        }\n        $Set = array_filter(\n            $Set,\n            function ($row) use ($pages_ids) {\n                return (bool)array_intersect((array)$row[\'pages_ids\'], $pages_ids);\n            }\n        );\n    }\n\n    $doSearch = false;\n\n    if ($Page->pid) {\n        // Точное соответствие\n        foreach (array(/*...*/) as $key) {\n            if ($IN[$key]) {\n                $doSearch = true;\n                $Set = array_filter(\n                    $Set,\n                    function ($x) use ($IN, $key) {\n                        return (bool)array_intersect((array)$x[$key], (array)$IN[$key]);\n                    }\n                );\n            }\n        }\n\n        // Вхождение подстроки\n        $getValueSubstringFilterFunction = function ($IN, $key) {\n            return function ($y) use ($IN, $key) {\n                return (bool)stristr($y, $IN[$key]);\n            };\n        };\n        foreach (array(\'article\') as $key) {\n            if ($IN[$key]) {\n                $doSearch = true;\n                $Set = array_filter(\n                    $Set,\n                    function ($x) use ($IN, $key, $getValueSubstringFilterFunction) {\n                        return (bool)array_filter((array)$x[$key], $getValueSubstringFilterFunction($IN, $key));\n                    }\n                );\n            }\n        }\n\n        // От .. до\n        $getValueFromToFilterFunction = function ($IN, $key, $from = true) {\n            if ($from) {\n                return function ($y) use ($IN, $key) {\n                    return $y >= $IN[$key . \'_from\'];\n                };\n            } else {\n                return function ($y) use ($IN, $key) {\n                    return $y <= $IN[$key . \'_to\'];\n                };\n            }\n        };\n\n        $getRowFromToFilterFunction = function ($IN, $key, $from = true) use ($getValueFromToFilterFunction) {\n            $f = $getValueFromToFilterFunction($IN, $key, $from);\n            return function ($x) use ($key, $f) {\n                return (bool)array_filter((array)$x[$key], $f);\n            };\n        };\n        foreach (array(\'price\') as $key) {\n            if ($IN[$key . \'_from\']) {\n                $doSearch = true;\n                $Set = array_filter($Set, $getRowFromToFilterFunction($IN, $key, true));\n            }\n            if ($IN[$key . \'_to\']) {\n                $doSearch = true;\n                $Set = array_filter($Set, $getRowFromToFilterFunction($IN, $key, false));\n            }\n        }\n    }\n\n    if ($Page->visChildren && !$doSearch && $Page->pid) {\n        $cats = $Page->visChildren;\n        $temp = array();\n        foreach ($cats as $cat) {\n            $ids = array_merge(array($cat->id), (array)$cat->all_children_ids);\n            foreach ($Set as $row) {\n                if ((bool)array_intersect((array)$row[\'pages_ids\'], $ids)) {\n                    $temp[$cat->id]++;\n                }\n            }\n            $cat->reload();\n            unset($cat);\n        }\n        $cats = array();\n        foreach ($temp as $key => $val) {\n            $cats[$key] = new Page($key);\n            $cats[$key]->counter = $val;\n        }\n        $OUT[\'subCats\'] = array_values($cats);\n    }\n\n    if ($Set) {\n        $Set = array_filter(\n            $Set,\n            function ($row) use ($Page) {\n                return in_array($Page->id, (array)$row[\'pages_ids\']);\n            }\n        );\n        $sortFunction = array();\n        if (in_array($IN[\'sort\'], array(\'price\'))) {\n            // Вариант для сортировки из фильтра\n            $sortFunction[] = \'(\' . ($IN[\'order\'] == \'desc\' ? \'-1 * \' : \'\') . \'((int)$a[\"\' . $IN[\'sort\'] . \'\"] - (int)$b[\"\' . $IN[\'sort\'] . \'\"]))\';\n        } else {\n            $sortFunction[] = \'((int)(bool)$b[\"priority\"] - (int)(bool)$a[\"priority\"])\';\n            $sortFunction[] = \'((int)$a[\"priority\"] - (int)$b[\"priority\"])\';\n            // Вариант для статической сортировки\n            if (isset($Block->sort_var_name, $IN[(string)$Block->sort_var_name])) {\n                $sortKey = $IN[(string)$Block->sort_var_name];\n                if ($f = $MType->fields[$sortKey]->id) {\n                    $sortFunction[] = \'strnatcmp($a[\"\' . addslashes($sortKey) . \'\"], $b[\"\' . addslashes($sortKey) . \'\"])\';\n                }\n            }\n            $sortFunction[] = \'((int)$a[\"price\"] - (int)$b[\"price\"])\';\n        }\n        $sortFunction = \'return (\' . implode(\' ?: \', $sortFunction) . \');\';\n        $sortFunction = create_function(\'$a, $b\', $sortFunction);\n        usort($Set, $sortFunction);\n\n        if (isset($Block->pages_var_name, $Block->rows_per_page) && (int)$Block->rows_per_page) {\n            $Pages = new \\SOME\\Pages(isset($IN[$Block->pages_var_name]) ? (int)$IN[$Block->pages_var_name] : 1, (int)$Block->rows_per_page);\n        }\n\n        $Set = \\SOME\\SOME::getArraySet($Set, $Pages);\n        $nativeFields = Material::_classes();\n        $nativeFields = $nativeFields[\'RAAS\\\\CMS\\\\Material\'][\'fields\'];\n        $Set = array_map(function ($row) use ($nativeFields) {\n            $native = array_intersect_key($row, array_flip($nativeFields));\n            $row2 = new Material($native);\n            $row2->metacache = $row;\n            return $row2;\n        }, $Set);\n\n        $OUT[\'Set\'] = $Set;\n        if ($Pages !== null) {\n            $OUT[\'Pages\'] = $Pages;\n        }\n    }\n\n    $OUT[\'MType\'] = $MType;\n    $OUT[\'doSearch\'] = $doSearch;\n}\nreturn $OUT;\n',0),(32,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'cart','<?php\nnamespace RAAS\\CMS\\Shop;\n\nuse \\RAAS\\CMS\\Material;\nuse \\RAAS\\CMS\\Package;\n\nfunction formatPrice($price)\n{\n    $remainder = (float)$price - (float)(int)$price;\n    return str_replace(\' \', \'&nbsp;\', number_format((float)$price, ($remainder > 0) ? 2 : 0, \',\', \' \' ));\n}\n\nif ($_GET[\'AJAX\']) {\n    $temp = array();\n    $temp[\'count\'] = (int)$Cart->count;\n    $temp[\'sum\'] = (float)$Cart->sum;\n    $temp[\'no_amount\'] = (int)$Cart->no_amount;\n    foreach ($Cart->items as $row) {\n        $row2 = new Material($row->id);\n        $temp[\'items\'][] = array(\n            \'id\' => $row->id,\n            \'meta\' => $row->meta,\n            \'amount\' => $row->amount,\n            \'price\' => $row->realprice,\n            \'name\' => $row->name,\n            \'url\' => $row2->url,\n			      \'image\' => \'/\' . $row2->visImages[0]->smallURL,\n            \'min\' => $row2->min,\n        );\n    }\n    echo json_encode($temp);\n    exit;\n} elseif ($epayWidget && ($epayWidget instanceof \\RAAS\\CMS\\Snippet)) {\n    eval(\'?\' . \'>\' . $epayWidget->description);\n} elseif ($success[(int)$Block->id]) {\n    ?>\n    <div class=\"notifications\">\n      <div class=\"alert alert-success\"><?php echo sprintf(ORDER_SUCCESSFULLY_SENT, $Item->id)?></div>\n    </div>\n<?php } elseif ($Cart->items) { ?>\n    <div class=\"cart\">\n      <form action=\"#feedback\" method=\"post\" enctype=\"multipart/form-data\">\n        <div class=\"cart__inner\">\n          <table class=\"table table-striped cart-table\" data-role=\"cart-table\">\n            <thead>\n              <tr>\n                <th class=\"cart-table__image-col\"><?php echo IMAGE?></th>\n                <th class=\"cart-table__name-col\"><?php echo NAME?></th>\n                <th class=\"cart-table__price-col\"><?php echo PRICE?></th>\n                <?php if (!$Cart->cartType->no_amount) { ?>\n                    <th class=\"cart-table__amount-col\"><?php echo AMOUNT?></th>\n                    <th class=\"cart-table__sum-col\"><?php echo SUM?></th>\n                <?php } ?>\n                <th class=\"cart-table__actions-col\"></th>\n              </tr>\n            </thead>\n            <tbody data-role=\"cart__body_main\">\n              <?php $sum = $am = 0; foreach ($Cart->items as $row) { $row2 = new Material((int)$row->id); ?>\n                <tr data-role=\"cart-item\" data-id=\"<?php echo (int)$row->id?>\" data-price=\"<?php echo number_format($row->realprice, 2, \'.\', \'\')?>\">\n                  <td class=\"cart-table__image-col\">\n                    <?php if ($row2->visImages) { ?>\n                        <a <?php echo $row2->url ? \'href=\"\' . htmlspecialchars($row2->url) . \'\"\' : \'\'?>>\n                          <img src=\"/<?php echo htmlspecialchars(addslashes($row2->visImages[0]->smallURL))?>\" style=\"max-width: 48px\" alt=\"<?php echo htmlspecialchars($row2->visImages[0]->name ?: $row->name)?>\" /></a>\n                    <?php } ?>\n                  </td>\n                  <td class=\"cart-table__name-col\"><a <?php echo $row2->url ? \'href=\"\' . htmlspecialchars($row2->url) . \'\"\' : \'\'?>><?php echo htmlspecialchars($row->name)?></a></td>\n                  <td data-role=\"price\" class=\"cart-table__price-col\">\n                    <?php echo formatPrice($row->realprice)?> <span class=\"fa fa-rub\"></span>\n                    <?php if ($Cart->cartType->no_amount) { ?>\n                        <input type=\"hidden\" name=\"amount[<?php echo htmlspecialchars((int)$row->id . \'_\' . $row->meta)?>]\" value=\"<?php echo (int)$row->amount?>\" />\n                    <?php } ?>\n                  </td>\n                  <?php if (!$Cart->cartType->no_amount) { ?>\n                      <td class=\"cart-table__amount-col\"><input type=\"number\" class=\"form-control\" style=\"max-width: 8em\" data-role=\"amount\" name=\"amount[<?php echo htmlspecialchars((int)$row->id . \'_\' . $row->meta)?>]\" min=\"<?php echo (int)$row2->min ?: 1?>\" value=\"<?php echo (int)$row->amount?>\" /></td>\n                      <td class=\"cart-table__sum-col\"><span data-role=\"sum\"><?php echo formatPrice($row->amount * $row->realprice)?></span> <span class=\"fa fa-rub\"></span></td>\n                  <?php } ?>\n                  <td class=\"cart-table__actions-col\">\n                    <a href=\"?action=delete&id=<?php echo (int)$row->id . ($row->meta ? \'&meta=\' . htmlspecialchars($row->meta) : \'\')?>\" data-role=\"delete-item\">\n                      <i class=\"fa fa-remove\" title=\"<?php echo DELETE?>\"></i>\n                    </a>\n                  </td>\n                </tr>\n              <?php $sum += $row->amount * $row->realprice; $am += $row->amount; } ?>\n			</tbody>\n			<tbody>\n              <?php if ($Form->id) { ?>\n                  <tr>\n                    <th colspan=\"<?php echo !$Cart->cartType->no_amount ? \'3\' : \'2\'?>\"><?php echo TOTAL_SUM?>:</th>\n                    <?php if (!$Cart->cartType->no_amount) { ?>\n                        <th class=\"cart-table__amount-col\"><span data-role=\"total-amount\"><?php echo (int)$am; ?></span></td>\n                    <?php } ?>\n                    <th class=\"cart-table__sum-col\"><span data-role=\"total-sum\"><?php echo formatPrice($sum)?></span>&nbsp;<span class=\"fa fa-rub\"></span></th>\n                    <th class=\"cart-table__actions-col\"></th>\n                  </tr>\n              <?php } ?>\n            </tbody>\n          </table>\n        </div>\n        <?php if ($Form->id) { ?>\n            <div class=\"form-horizontal\">\n              <?php include Package::i()->resourcesDir . \'/form2.inc.php\'?>\n              <div data-role=\"notifications\" <?php echo ($success[(int)$Block->id] || $localError) ? \'\' : \'style=\"display: none\"\'?>>\n                <div class=\"alert alert-success\" <?php echo ($success[(int)$Block->id]) ? \'\' : \'style=\"display: none\"\'?>><?php echo FEEDBACK_SUCCESSFULLY_SENT?></div>\n                <div class=\"alert alert-danger\" <?php echo ($localError) ? \'\' : \'style=\"display: none\"\'?>>\n                  <ul>\n                    <?php foreach ((array)$localError as $key => $val) { ?>\n                        <li><?php echo htmlspecialchars($val)?></li>\n                    <?php } ?>\n                  </ul>\n                </div>\n              </div>\n\n              <div data-role=\"feedback-form\" <?php echo $success[(int)$Block->id] ? \'style=\"display: none\"\' : \'\'?>>\n                <p><?php echo ASTERISK_MARKED_FIELDS_ARE_REQUIRED?></p>\n                <?php if ($Form->signature) { ?>\n                      <input type=\"hidden\" name=\"form_signature\" value=\"<?php echo md5(\'form\' . (int)$Form->id . (int)$Block->id)?>\" />\n                <?php } ?>\n                <?php if ($Form->antispam == \'hidden\' && $Form->antispam_field_name) { ?>\n                      <input type=\"text\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" value=\"<?php echo htmlspecialchars($DATA[$Form->antispam_field_name])?>\" style=\"position: absolute; left: -9999px\" />\n                <?php } ?>\n                <?php foreach ($Form->fields as $row) { ?>\n                    <div class=\"form-group\">\n                      <label<?php echo !$row->multiple ? \' for=\"\' . htmlspecialchars($row->urn . $row->id . \'_\' . $Block->id) . \'\"\' : \'\'?> class=\"control-label col-sm-3 col-md-2\"><?php echo htmlspecialchars($row->name . ($row->required ? \'*\' : \'\'))?></label>\n                      <div class=\"col-sm-9 col-md-4\">\n                        <?php $getField($row, $DATA); ?>\n                      </div>\n                    </div>\n                <?php } ?>\n                <?php if ($Form->antispam == \'captcha\' && $Form->antispam_field_name) { ?>\n                    <div class=\"form-group\">\n                      <label for=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" class=\"control-label col-sm-3 col-md-2\"><?php echo CAPTCHA?></label>\n                      <div class=\"col-sm-9 col-md-4\">\n                        <img src=\"/assets/kcaptcha/?<?php echo session_name() . \'=\' . session_id()?>\" /><br />\n                        <input type=\"text\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" />\n                      </div>\n                    </div>\n                <?php } ?>\n                <?php if ($Block->EPay_Interface->id && !$Form->fields[\'epay\']) { ?>\n                    <div class=\"form-group\">\n                      <label for=\"name\" class=\"control-label col-sm-3 col-md-2\"><?php echo PAYMENT_METHOD?></label>\n                      <div class=\"col-sm-9 col-md-4\">\n                        <label><input type=\"radio\" name=\"epay\" value=\"0\" <?php echo !$DATA[\'epay\'] ? \'checked=\"checked\"\' : \'\'?> /> <?php echo PAY_ON_DELIVERY?></label>\n                        <label><input type=\"radio\" name=\"epay\" value=\"1\" <?php echo $DATA[\'epay\'] ? \'checked=\"checked\"\' : \'\'?> /> <?php echo PAY_BY_EPAY?></label>\n                      </div>\n                    </div>\n                <?php } ?>\n                <div class=\"form-group\">\n                  <div class=\"col-sm-9 col-md-4 col-sm-offset-3 col-md-offset-2\"><button class=\"btn btn-primary\" type=\"submit\"><?php echo SEND?></button></div>\n                </div>\n              </div>\n            </div>\n        <?php } else { ?>\n          <p><a href=\"?action=clear\" data-role=\"clear-cart-trigger\"><?php echo CLEAR_FAVORITES?></a></p>\n        <?php } ?>\n      </form>\n    </div>\n    <script src=\"/js/cart.js\"></script>\n<?php\n} else {\n    if ($Form->id) {\n        echo YOUR_CART_IS_EMPTY;\n    } else {\n        echo YOUR_FAVORITES_IS_EMPTY;\n    }\n}\n?>\n',0),(33,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'robokassa','<?php\nnamespace RAAS\\CMS\\Shop;\n\nuse \\RAAS\\CMS\\Material;\nuse \\RAAS\\CMS\\Package;\n\nif ($success[(int)$Block->id] || $localError) {\n    ?>\n    <div class=\"notifications\">\n      <?php if ($success[(int)$Block->id]) { ?>\n          <div class=\"alert alert-success\"><?php echo htmlspecialchars($success[(int)$Block->id])?></div>\n      <?php } elseif ($localError) { ?>\n          <div class=\"alert alert-danger\">\n            <ul>\n              <?php foreach ((array)$localError as $key => $val) { ?>\n                  <li><?php echo htmlspecialchars($val)?></li>\n              <?php } ?>\n            </ul>\n          </div>\n      <?php } ?>\n    </div>\n<?php } ?>\n<?php if ($Item->id) { ?>\n    <section class=\"cart\">\n      <h2><?php echo htmlspecialchars(sprintf(ORDER_NUM, (int)$Item->id, $_SERVER[\'HTTP_HOST\']))?></h2>\n      <table class=\"table table-striped cart-table\" data-role=\"cart-table\">\n        <thead>\n          <tr>\n            <th class=\"cart-table__image-col\"><?php echo IMAGE?></th>\n            <th class=\"cart-table__name-col\"><?php echo NAME?></th>\n            <th class=\"cart-table__price-col\"><?php echo PRICE?></th>\n            <th class=\"cart-table__amount-col\"><?php echo AMOUNT?></th>\n            <th class=\"cart-table__sum-col\"><?php echo SUM?></th>\n          </tr>\n        </thead>\n        <tbody>\n          <?php foreach ($Item->items as $row) { $row2 = new Material((int)$row->id); ?>\n            <tr data-role=\"cart-item\">\n              <td class=\"text-center cart-table__image-col\">\n                <?php if ($row2->visImages) { ?>\n                    <a <?php echo $row2->url ? \'href=\"\' . htmlspecialchars($row2->url) . \'\" target=\"_blank\"\' : \'\'?>>\n                      <img src=\"/<?php echo htmlspecialchars(addslashes($row2->visImages[0]->tnURL))?>\" style=\"max-width: 48px\" alt=\"<?php echo htmlspecialchars($row2->visImages[0]->name ?: $row->name)?>\" target=\"_blank\" /></a>\n                <?php } ?>\n              </td>\n              <td class=\"cart-table__name-col\">\n                <a <?php echo $row2->url ? \'href=\"\' . htmlspecialchars($row2->url) . \'\" target=\"_blank\"\' : \'\'?>><?php echo htmlspecialchars($row->name)?></a>\n              </td>\n              <td data-role=\"price\" class=\"cart-table__price-col\">\n                <?php echo formatPrice($row->realprice)?> <span class=\"fa fa-rub\"></span>\n              </td>\n              <td class=\"cart-table__amount-col\"><?php echo (int)$row->amount?></td>\n              <td class=\"cart-table__sum-col\"><span data-role=\"sum\"><?php echo formatPrice($row->amount * $row->realprice)?></span> <span class=\"fa fa-rub\"></span></td>\n            </tr>\n          <?php } ?>\n          <tr>\n            <th colspan=\"3\"><?php echo TOTAL_SUM?>:</th>\n            <th class=\"cart-table__amount-col\"><span data-role=\"total-amount\"><?php echo (int)$Item->count; ?></span></td>\n            <th class=\"cart-table__sum-col\"><span data-role=\"total-sum\"><?php echo formatPrice($Item->sum)?></span>&nbsp;<span class=\"fa fa-rub\"></span></th>\n          </tr>\n        </tbody>\n      </table>\n      <div class=\"form-horizontal\">\n        <div data-role=\"feedback-form\">\n          <div class=\"form-group\">\n            <label class=\"control-label col-sm-3 col-md-2\"><?php echo YOUR_ORDER_ID?></label>\n            <div class=\"col-sm-9 col-md-4\"><strong><?php echo (int)$Item->id?></strong></div>\n          </div>\n          <?php foreach ($Item->fields as $row) { ?>\n              <div class=\"form-group\">\n                <label class=\"control-label col-sm-3 col-md-2\"><?php echo htmlspecialchars($row->name)?></label>\n                <div class=\"col-sm-9 col-md-4\"><?php echo htmlspecialchars($Item->fields[$row->urn]->doRich())?></div>\n              </div>\n          <?php } ?>\n          <?php if ($requestForPayment) { ?>\n              <div class=\"form-group\">\n                <form action=\"<?php echo htmlspecialchars($paymentURL)?>\" method=\"post\" enctype=\"multipart/form-data\">\n                  <input type=\"hidden\" name=\"MrchLogin\" value=\"<?php echo htmlspecialchars($Block->epay_login)?>\" />\n                  <input type=\"hidden\" name=\"OutSum\" value=\"<?php echo number_format((float)$Item->sum, 2, \'.\', \'\')?>\" />\n                  <input type=\"hidden\" name=\"InvId\" value=\"<?php echo (int)$Item->id?>\" />\n                  <input type=\"hidden\" name=\"Desc\" value=\"<?php echo sprintf(ORDER_NUM, (int)$Item->id, $_SERVER[\'HTTP_HOST\'])?>\" />\n                  <input type=\"hidden\" name=\"SignatureValue\" value=\"<?php echo htmlspecialchars($crc)?>\" />\n                  <?php if (!$Block->epay_test && $Block->epay_currency && ($Block->epay_currency != \'RUR\')) { ?>\n                      <input type=\"hidden\" name=\"OutSumCurrency\" value=\"<?php echo htmlspecialchars($Block->epay_currency)?>\" />\n                  <?php } ?>\n                  <input type=\"hidden\" name=\"Culture\" value=\"<?php echo htmlspecialchars($Page->lang)?>\" />\n                  <input type=\"hidden\" name=\"Encoding\" value=\"UTF-8\" />\n                  <div class=\"col-sm-9 col-md-4 col-sm-offset-3 col-md-offset-2\"><button class=\"btn btn-primary\" type=\"submit\"><?php echo PAY?></button></div>\n                </form>\n              </div>\n          <?php } ?>\n        </div>\n      </div>\n    </section>\n<?php } ?>\n',0),(34,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'yml','<?php\nnamespace RAAS\\CMS\\Shop;\n\nuse \\DOMDocument;\n\nheader(\'Content-Type: application/xml\');\n// echo $yml->asXML();\n// $dom = new DOMDocument(\'1.0\');\n// $dom->preserveWhiteSpace = false;\n// $dom->formatOutput = true;\n// $dom->loadXML($yml->asXML());\n// echo $dom->saveXML();\n',0),(35,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'item_inc','<?php\nnamespace RAAS\\CMS\\Shop;\n\n$formatPrice = function($price) {\n    $remainder = (float)$price - (float)(int)$price;\n    return str_replace(\' \', \'&nbsp;\', number_format((float)$price, ($remainder > 0) ? 2 : 0, \',\', \' \' ));\n};\n\n$showItem = function($row) use ($formatPrice)\n{\n    ?>\n    <div class=\"catalog-item\">\n      <div class=\"catalog-item__title\">\n        <a href=\"<?php echo $row->url?>\"><?php echo htmlspecialchars($row->name)?></a>\n      </div>\n      <?php if ($row->article) { ?>\n          <div class=\"catalog-item__article\">\n            <?php echo ARTICLE_SHORT?>\n            <a href=\"<?php echo $row->url?>\"><?php echo htmlspecialchars($row->article)?></a>\n          </div>\n      <?php } ?>\n      <a href=\"<?php echo $row->url?>\" class=\"catalog-item__image<?php echo !$row->visImages ? \' catalog-item__image_nophoto\' : \'\'?>\">\n        <?php if ($row->visImages) { ?>\n            <img src=\"/<?php echo htmlspecialchars(addslashes($row->visImages[0]->smallURL))?>\" alt=\"<?php echo htmlspecialchars($row->visImages[0]->name ?: $row->name)?>\" />\n        <?php } ?>\n      </a>\n      <form action=\"/cart/\" class=\"catalog-item__controls\" data-role=\"add-to-cart-form\" data-id=\"<?php echo (int)$row->id?>\" data-price=\"<?php echo (int)$row->price?>\">\n        <?php if ($row->available) { ?>\n            <input type=\"hidden\" name=\"action\" value=\"add\" />\n            <input type=\"hidden\" name=\"id\" value=\"<?php echo (int)$row->id?>\" />\n            <input type=\"hidden\" name=\"back\" value=\"1\" />\n            <?php /* <input type=\"hidden\" name=\"amount\" value=\"1\" /> */?>\n        <?php } ?>\n        <div class=\"catalog-item__text\">\n          <div class=\"catalog-item__price-container\" data-price=\"<?php echo (float)$row->price?>\">\n            <?php if ($row->price_old && ($row->price_old != $row->price)) { ?>\n                <span class=\"catalog-item__price catalog-item__price_old\"><?php echo $formatPrice((float)$row->price_old)?></span>\n            <?php } ?>\n            <span class=\"catalog-item__price <?php echo ($row->price_old && ($row->price_old != $row->price)) ? \' catalog-item__price_new\' : \'\'?>\">\n              <span data-role=\"price-container\">\n                <?php echo $formatPrice((float)$row->price)?>\n              </span>\n              <i class=\"fa fa-rub\"></i>\n            </span>\n          </div>\n          <div class=\"catalog-item__available\"><?php echo $row->available ? \'<span class=\"text-success\">В наличии</span>\' : \'<span class=\"text-danger\">Под заказ</span>\'?></div>\n        </div>\n        <div class=\"catalog-item__read-more\">\n          <!--noindex-->\n          <div class=\"catalog-item__add-to-cart\">\n            <?php if ($row->available) { ?>\n                <input type=\"number\" class=\"form-control\" autocomplete=\"off\" name=\"amount\" min=\"<?php echo (int)$row->min ?: 1?>\" step=\"<?php echo (int)$row->step ?: 1?>\" value=\"<?php echo (int)$row->min ?: 1?>\" />\n                <button type=\"submit\" class=\"btn btn-danger\" title=\"<?php echo TO_CART?>\"><span class=\"fa fa-shopping-cart\"></span></button>\n                <?php /* <a href=\"/cart/?action=add&id=<?php echo (int)$row->id?>\" class=\"btn btn-danger\" data-role=\"add-to-cart-trigger\" data-id=\"<?php echo (int)$row->id?>\" data-price=\"<?php echo (int)$row->price?>\" title=\"<?php echo TO_CART?>\" data-active-title=\"<?php echo DELETE_FROM_CART?>\"><span class=\"fa fa-shopping-cart\"></span></a> */ ?>\n            <?php } ?>\n            <a href=\"/favorites/?action=add&id=<?php echo (int)$row->id?>\" class=\"btn btn-info\" data-role=\"add-to-favorites-trigger\" data-id=\"<?php echo (int)$row->id?>\" title=\"<?php echo TO_FAVORITES?>\" data-active-title=\"<?php echo DELETE_FROM_FAVORITES?>\" rel=\"nofollow\"><span class=\"fa fa-star\"></span></a>\n          </div>\n          <!--/noindex-->\n        </div>\n      </form>\n    </div>\n    <?php\n};\n',0),(36,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'category_inc','<?php\nnamespace RAAS\\CMS\\Shop;\n\n$showCategory = function($row)\n{\n    $queryString = http_build_query(array_intersect_key($_GET, array_flip(array(\'brand\', \'model\', \'engine\'))));\n    $queryString = $queryString ? \'?\' . $queryString : \'\';\n    ?>\n    <a class=\"catalog-category\" href=\"<?php echo $row->url . $queryString ?>\">\n      <div class=\"catalog-category__image<?php echo !$row->image->id ? \' catalog-category__image_nophoto\' : \'\'?>\">\n        <?php if ($row->image->id) { ?>\n            <img src=\"/<?php echo htmlspecialchars(addslashes($row->image->smallURL))?>\" alt=\"<?php echo htmlspecialchars($row->image->name ?: $row->name)?>\" />\n        <?php } ?>\n      </div>\n      <div class=\"catalog-category__text\">\n        <div class=\"catalog-category__title\">\n          <?php echo htmlspecialchars($row->name . ((int)$row->counter ? \' (\' . (int)$row->counter . \')\' : \'\'))?>\n        </div>\n      </div>\n    </a>\n    <?php\n};\n',0),(37,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'catalog','<?php\nnamespace RAAS\\CMS;\n\nuse RAAS\\CMS\\Shop\\Video;\nuse RAAS\\Attachment;\n\neval(\'?\' . \'>\' . Snippet::importByURN(\'category_inc\')->description);\neval(\'?\' . \'>\' . Snippet::importByURN(\'item_inc\')->description);\neval(\'?\' . \'>\' . Snippet::importByURN(\'file_inc\')->description);\n$formatPrice = function($price) {\n    $remainder = (float)$price - (float)(int)$price;\n    return str_replace(\' \', \'&nbsp;\', number_format((float)$price, ($remainder > 0) ? 2 : 0, \',\', \' \' ));\n};\n\n\nif ($Item) {\n    ?>\n    <div class=\"catalog\">\n      <div class=\"catalog-article\" itemscope itemtype=\"http://schema.org/Product\">\n        <meta itemprop=\"name\" content=\"<?php echo htmlspecialchars($Item->name)?>\" />\n        <div class=\"catalog-article__article\">\n          <?php echo ARTICLE_SHORT?> <span itemprop=\"productID\"><?php echo htmlspecialchars($Item->article)?></span>\n        </div>\n        <div class=\"row\">\n          <?php if ($Item->visImages) { ?>\n              <div class=\"col-sm-6 col-lg-5\">\n                <div class=\"catalog-article__images-container\">\n                  <div class=\"catalog-article__image\">\n                    <?php for ($i = 0; $i < count($Item->visImages); $i++) { ?>\n                        <a itemprop=\"image\" href=\"/<?php echo $Item->visImages[$i]->fileURL?>\" <?php echo $i ? \'style=\"display: none\"\' : \'\'?> data-image-num=\"<?php echo (int)$i?>\" data-lightbox-gallery=\"g\">\n                          <img src=\"/<?php echo htmlspecialchars($Item->visImages[$i]->tnURL)?>\" alt=\"<?php echo htmlspecialchars($Item->visImages[$i]->name ?: $row->name)?>\" /></a>\n                    <?php } ?>\n                  </div>\n                  <?php if (count($Item->visImages) > 1) { ?>\n                      <div class=\"catalog-article__images hidden-xs\">\n                        <?php for ($i = 0; $i < count($Item->visImages); $i++) { $row = $Item->visImages[$i]; ?>\n                            <div data-href=\"/<?php echo htmlspecialchars(addslashes($row->fileURL))?>\" class=\"catalog-article__additional-image\" data-image-num=\"<?php echo (int)$i?>\">\n                              <img src=\"/<?php echo htmlspecialchars($row->tnURL)?>\" alt=\"<?php echo htmlspecialchars($row->name)?>\" /></div>\n                        <?php } ?>\n                      </div>\n                  <?php } ?>\n                </div>\n              </div>\n          <?php } ?>\n          <div class=\"col-sm-6 col-lg-7\">\n            <div class=\"catalog-article__details\">\n              <div itemprop=\"offers\" itemscope itemtype=\"http://schema.org/Offer\">\n                <div class=\"catalog-article__text\">\n                  <div class=\"catalog-article__price-container\" data-price=\"<?php echo (float)$Item->price?>\">\n                    <?php if ($Item->price_old && ($Item->price_old != $Item->price)) { ?>\n                        <span class=\"catalog-article__price catalog-article__price_old\"><?php echo $formatPrice((float)$Item->price_old)?></span>\n                    <?php } ?>\n                    <span class=\"catalog-article__price <?php echo ($Item->price_old && ($Item->price_old != $Item->price)) ? \' catalog-article__price_new\' : \'\'?>\">\n                      <span data-role=\"price-container\" itemprop=\"price\" content=\"<?php echo (float)$Item->price?>\">\n                        <?php echo $formatPrice((float)$Item->price)?>\n                      </span>\n                      <i class=\"fa fa-rub\" itemprop=\"priceCurrency\" content=\"RUB\"></i>\n                    </span>\n                  </div>\n                </div>\n                <div class=\"catalog-article__available\">\n                  <link itemprop=\"availability\" href=\"http://schema.org/<?php echo $Item->available ? \'InStock\' : \'PreOrder\'?>\" />\n                  <?php echo $Item->available ? \'<span class=\"text-success\">\' . AVAILABLE . \'</span>\' : \'<span class=\"text-danger\">\' . AVAILABLE_CUSTOM . \'</span>\'?>\n                </div>\n              </div>\n              <!--noindex-->\n              <form action=\"/cart/\" class=\"catalog-article__controls\" data-role=\"add-to-cart-form\" data-id=\"<?php echo (int)$Item->id?>\" data-price=\"<?php echo (int)$Item->price?>\">\n                <?php if ($Item->available) { ?>\n                    <input type=\"hidden\" name=\"action\" value=\"add\" />\n                    <input type=\"hidden\" name=\"id\" value=\"<?php echo (int)$Item->id?>\" />\n                    <input type=\"hidden\" name=\"back\" value=\"1\" />\n                    <input type=\"number\" class=\"form-control\" autocomplete=\"off\" name=\"amount\" min=\"<?php echo (int)$Item->min ?: 1?>\" step=\"<?php echo (int)$Item->step ?: 1?>\" value=\"<?php echo (int)$Item->min ?: 1?>\" />\n                    <button type=\"submit\" class=\"btn btn-danger\"><?php echo TO_CART?></button>\n                    <?php /* <a href=\"/cart/?action=add&id=<?php echo (int)$Item->id?>\" class=\"btn btn-danger\" data-role=\"add-to-cart-trigger\" data-id=\"<?php echo (int)$Item->id?>\" data-price=\"<?php echo (int)$Item->price?>\" data-active-html=\"<?php echo DELETE_FROM_CART?>\"><?php echo TO_CART?></button> */ ?>\n                <?php } ?>\n                <a href=\"/favorites/?action=add&id=<?php echo (int)$Item->id?>\" class=\"btn btn-info\" data-role=\"add-to-favorites-trigger\" data-id=\"<?php echo (int)$Item->id?>\" data-active-html=\"<?php echo DELETE_FROM_FAVORITES?>\" rel=\"nofollow\"><?php echo TO_FAVORITES?></a>\n              </form>\n              <!--/noindex-->\n              <!--noindex-->\n              <div class=\"share\">\n                <script type=\"text/javascript\" src=\"//yastatic.net/share/share.js\" charset=\"utf-8\"></script>\n                <?php echo SHARE?>: <div class=\"yashare-auto-init\" style=\"display: inline-block; vertical-align: middle\" data-yashareL10n=\"ru\" data-yashareQuickServices=\"vkontakte,facebook,twitter,odnoklassniki,moimir\" data-yashareTheme=\"counter\"></div>\n              </div>\n              <!--/noindex-->\n              <?php\n              $propsText = \'\';\n              $brands = $models = array();\n              foreach ((array)$Item->model as $val) {\n                  $brands[$val->brand->id] = $val->brand->name;\n                  $models[$val->id] = $val->name;\n              }\n              unset($temp);\n              foreach ($Item->fields as $key => $val) {\n                  if (\n                      !in_array(\n                          $val->urn,\n                          array(\'images\', \'brief\', \'videos\', \'videos_url\', \'files\', \'onmain\', \'article\', \'price\', \'price_old\', \'available\', \'min\', \'step\')\n                      ) &&\n                      !in_array($val->datatype, array(\'image\', \'file\', \'material\', \'checkbox\'))\n                  ) {\n                      if ($val->doRich()) {\n                          $v = implode(\', \', array_map(function($x) use ($val) { return $val->doRich($x); }, $val->getValues(true)));\n                          switch ($key) {\n                              case \'width\': case \'height\':\n                                  $propsText .= \' <tr>\n                                                    <th>\' . htmlspecialchars($val->name) . \': </th>\n                                                    <td itemprop=\"<?php echo $key?>\" itemtype=\"http://schema.org/QuantitativeValue\">\n                                                      <span itemprop=\"value\">\' . $v . \'</span>\n                                                    </td>\n                                                  </tr>\';\n                                  break;\n                              case \'article\':\n                                  $propsText .= \' <tr>\n                                                    <th>\' . htmlspecialchars($val->name) . \': </th>\n                                                    <td itemprop=\"productID\">\' . $val[\'doRich\'] . \'</td>\n                                                  </tr>\';\n                                  break;\n                              case \'brand\':\n                                  $propsText .= \' <tr>\n                                                    <th>\' . htmlspecialchars($val->name) . \': </th>\n                                                    <td itemprop=\"brand\" itemscope itemtype=\"http://schema.org/Brand\">\n                                                      <span itemprop=\"name\">\' . $v . \'</span>\n                                                    </td>\n                                                  </tr>\';\n                                  break;\n                              default:\n                                  $propsText .= \' <tr itemprop=\"additionalProperty\" itemscope itemtype=\"http://schema.org/PropertyValue\">\n                                                    <th itemprop=\"name\">\' . htmlspecialchars($val->name) . \': </th>\n                                                    <td itemprop=\"value\">\' . $v . \'</td>\n                                                  </tr>\';\n                                  break;\n                          }\n                      }\n                  }\n              }\n              if ($propsText) {\n                  echo \'<div class=\"catalog-article__props\">\n                          <table class=\"table table-striped\"><tbody>\' . $propsText . \'</tbody></table>\n                        </div>\n                        <div class=\"clearfix\"></div>\';\n              }\n              ?>\n            </div>\n          </div>\n        </div>\n        <?php\n        $tabs = array();\n        foreach (array(\'description\', \'files\', \'videos\', \'reviews\', \'related\') as $key) {\n            $text = \'\';\n            $name = $Item->fields[$key]->name;\n            switch ($key) {\n                case \'description\':\n                    $name = DESCRIPTION;\n                    $text = \'<div itemprop=\"description\">\' . trim($Item->description) . \'</div>\';\n                    break;\n                case \'files\':\n                    if ($Item->files) {\n                        $text = \'<div class=\"catalog-article__files\">\';\n                        foreach ($Item->files as $file) {\n                            $text .= \'<div class=\"catalog-article__file\">\n                                        <a href=\"/\' . htmlspecialchars($file->fileURL) . \'\">\'\n                                  .  \'    <span class=\"fa \' . $getFileIcon($file) . \'\"></span> \'\n                                  .       htmlspecialchars($file->name ?: basename($file->fileURL))\n                                  . \'   </a>\n                                      </div>\';\n                        }\n                        $text .= \'</div>\';\n                    }\n                    break;\n                case \'videos\':\n                    if ($Item->videos) {\n                        $text .= \'<div class=\"catalog-article__videos\">\';\n                        for ($i = 0; $i < (count($Item->videos) / 4); $i++) {\n                            $text .= \'<div class=\"row\">\';\n                            for ($j = $i * 4; $j < ($i + 1) * 4; $j++) {\n                                if ($val = $Item->videos[$j]) {\n                                    $ytid = $ytname = \'\';\n                                    if (preg_match(\'/^(.*?)((http(s?):\\\\/\\\\/.*?(((\\\\?|&)v=)|(embed\\\\/)|(youtu\\\\.be\\\\/)))([\\\\w\\\\-\\\\_]+).*?)$/\', $val, $regs)) {\n                                        $ytname = trim($regs[1]);\n                                        $ytid = trim($regs[10]);\n                                    }\n                                    if (!$ytname) {\n                                        $url = \'https://www.googleapis.com/youtube/v3/videos?part=snippet&id=\' . $ytid . \'&key=AIzaSyCJgMFQqq6Ax9WlGhuslTz4viyG3RbPEic\';\n                                        $json = file_get_contents($url);\n                                        $json = json_decode($json, true);\n                                        if (isset($json[\'items\'][0][\'snippet\'][\'title\'])) {\n                                            $ytname = trim($json[\'items\'][0][\'snippet\'][\'title\']);\n                                        }\n                                    }\n                                    $text .= \'<div class=\"col-sm-3\">\n                                                <div class=\"catalog-article__video\">\n                                                  <a href=\"https://youtube.com/embed/\' . $ytid . \'\" data-lightbox-gallery=\"v\" title=\"\' . htmlspecialchars($ytname) . \'\">\n                                                    <img src=\"https://i.ytimg.com/vi/\' . htmlspecialchars($ytid) . \'/hqdefault.jpg\" alt=\"\' . htmlspecialchars($ytname) . \'\">\n                                                  </a>\n                                                </div>\n                                              </div>\';\n\n                                }\n                            }\n                            $text .= \'</div>\';\n                        }\n                        $text .= \'</div>\';\n                    }\n                    break;\n                case \'reviews\':\n                    $name = REVIEWS . ($comments ? \' (\' . count($comments) . \')\' : \'\');\n                    ob_start();\n                    if ($comments) {\n                        eval(\'?\' . \'>\' . Snippet::importByURN(\'goods_comments\')->description);\n                    }\n                    if ($commentFormBlock) {\n                        $commentFormBlock->process($Page);\n                    }\n                    $text .= ob_get_clean();\n                    break;\n                case \'related\':\n                    if ($Item->related) {\n                        $text .= \'<div class=\"row catalog-list catalog-list_related\">\';\n                        foreach ($Item->related as $row) {\n                            $text .= \'<div class=\"catalog-list__item\">\';\n                            ob_start();\n                            $showItem($row);\n                            $text .= ob_get_clean();\n                            $text .= \'</div>\';\n                        }\n                        $text .= \'</div>\';\n                    }\n                    break;\n            }\n            if ($text) {\n                $tabs[$key] = array(\'name\' => $name, \'description\' => $text);\n            }\n        }\n        if ($tabs) {\n            ?>\n            <ul class=\"nav nav-tabs\" role=\"tablist\">\n              <?php $i = 0; foreach ($tabs as $key => $row) { ?>\n                  <li<?php echo !$i ? \' class=\"active\"\' : \'\'?>>\n                    <a href=\"#<?php echo $key?>\" aria-controls=\"<?php echo $key?>\" role=\"tab\" data-toggle=\"tab\">\n                      <?php echo htmlspecialchars($row[\'name\'])?>\n                    </a>\n                  </li>\n              <?php $i++; } ?>\n            </ul>\n            <div class=\"tab-content\" style=\"padding: 15px 0;\">\n              <?php $i = 0; foreach ($tabs as $key => $row) { ?>\n                  <div class=\"tab-pane<?php echo !$i ? \' active\' : \'\'?>\" id=\"<?php echo $key?>\"><?php echo $row[\'description\']?></div>\n              <?php $i++; } ?>\n            </div>\n        <?php } ?>\n      </div>\n    </div>\n<?php } else { ?>\n    <div class=\"catalog\">\n      <?php if ($Page->pid) { ?>\n          <div class=\"catalog__filter\">\n            <?php eval(\'?\' . \'>\' . Snippet::importByURN(\'catalog_filter\')->description)?>\n          </div>\n          <?php\n      }\n      ?>\n      <div class=\"catalog__inner\">\n        <?php\n        if ($Set || $subCats) {\n            if ($subCats) {\n                ?>\n                <div class=\"catalog__categories-list\">\n                  <div class=\"catalog-categories-list\">\n                    <?php foreach ($subCats as $row) { ?>\n                        <div class=\"catalog-categories-list__item\">\n                          <?php $showCategory($row);?>\n                        </div>\n                    <?php } ?>\n                  </div>\n                </div>\n                <?php\n            }\n            if ($Set) {\n                ?>\n                <div class=\"catalog__list\">\n                  <div class=\"catalog-list\">\n                    <?php foreach ($Set as $row) { ?>\n                        <div class=\"catalog-list__item\">\n                          <?php $showItem($row)?>\n                        </div>\n                    <?php } ?>\n                  </div>\n                </div>\n            <?php } ?>\n        <?php } else { ?>\n            <p><?php echo NO_RESULTS_FOUND?></p>\n        <?php } ?>\n      </div>\n      <?php\n      if ($Set) {\n          include \\RAAS\\CMS\\Package::i()->resourcesDir . \'/pages.inc.php\';\n          if ($Pages->pages > 1) {\n              ?>\n              <div data-pages=\"<?php echo $Pages->pages?>\">\n                <ul class=\"pagination pull-right\">\n                  <?php\n                  echo $outputNav(\n                      $Pages,\n                      array(\n                          \'pattern\' => \'<li><a href=\"\' . \\SOME\\HTTP::queryString(\'page={link}\') . \'\">{text}</a></li>\',\n                          \'pattern_active\' => \'<li class=\"active\"><a>{text}</a></li>\',\n                          \'ellipse\' => \'<li class=\"disabled\"><a>...</a></li>\'\n                      )\n                  );\n                  ?>\n                </ul>\n              </div>\n              <div class=\"clearfix\"></div>\n          <?php } ?>\n      <?php } ?>\n    </div>\n<?php } ?>\n',0),(38,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'catalog_filter','<?php\nnamespace RAAS\\CMS;\n\n$mt = microtime(1);\n$DATA = $_GET;\n$MType = Material_Type::importByURN(\'catalog\');\n$cc = new Catalog_Cache($MType);\nif (!$cc->load()) {\n    $cc->getCache();\n    $cc->save();\n}\n$cc = $cc->data;\n$cc = array_filter($cc, function($x) use ($Page) { return array_intersect(array_merge(array($Page->id), (array)$Page->all_children_ids), (array)$x[\'pages_ids\']); });\n\n$filterProps = array(/*\'example\' => \'Пример\', */);\n$filterRaw = array();\n$filter = array();\n\n// $dictionaryExample = new Dictionary(1);\n// $dictionaryExample = $dictionaryExample->children;\n// foreach ($dictionaryExample as $row) {\n//     $filterRaw[\'example\'][] = array(\'value\' => $row->urn, \'name\' => $row->name);\n// }\n\n\nforeach ($filterRaw as $key => $arr) {\n    $filterSet = $cc;\n    foreach ($filterProps as $key2 => $name) {\n        if (($key2 != $key) && $DATA[$key2]) {\n            $filterSet = array_filter(\n                $filterSet,\n                function ($x) use ($key2, $DATA) {\n                    return $x[$key2] == $DATA[$key2];\n                }\n            );\n        }\n    }\n    $filterSet = array_map(\n        function ($x) use ($key) {\n            return $x[$key];\n        },\n        $filterSet\n    );\n    $filter[$key] = array_filter(\n        $arr,\n        function ($x) use ($filterSet) {\n            return in_array($x[\'value\'], $filterSet);\n        }\n    );\n}\n\n$maxPrice = array_map(\n    function ($x) {\n        return (int)$x[\'price\'];\n    },\n    $cc\n);\n$maxPrice = max($maxPrice);\n$priceStep = 1000;\n$maxPrice = ceil($maxPrice / (int)$priceStep) * (int)$priceStep;\nif ($DATA[\'price_to\'] && $DATA[\'price_to\'] > $maxPrice) {\n    $DATA[\'price_to\'] = $maxPrice;\n}\n$price1 = floor($DATA[\'price_from\'] / (int)$priceStep) * (int)$priceStep;\n$price2 = ceil(($DATA[\'price_to\'] ?: $maxPrice) / (int)$priceStep) * (int)$priceStep;\n\n// echo microtime(1) - $mt;\n?>\n<!--noindex-->\n<div class=\"catalog-filter\">\n  <form action=\"\" method=\"get\" data-page-id=\"<?php echo (int)$Page->id?>\">\n    <div class=\"row\">\n      <div class=\"col-sm-3\">\n        <div><label><?php echo ARTICLE?></label></div>\n        <div class=\"catalog-filter__property\">\n          <input type=\"text\" class=\"form-control\" name=\"article\" placeholder=\"Артикул\" value=\"<?php echo htmlspecialchars($_GET[\'article\'])?>\">\n        </div>\n      </div>\n      <div class=\"col-sm-4\">\n        <div><label><?php echo PRICE?></label></div>\n        <div class=\"catalog-filter__property catalog-filter__price\">\n          <div class=\"row\">\n            <div class=\"col-xs-1\">от</div>\n            <div class=\"col-xs-5\"><input type=\"number\" class=\"form-control\" min=\"0\" max=\"<?php echo (int)$maxPrice?>\" step=\"<?php echo (int)$priceStep?>\" name=\"price_from\" placeholder=\"От\" value=\"<?php echo htmlspecialchars($price1)?>\"></div>\n            <div class=\"col-xs-1\">до</div>\n            <div class=\"col-xs-5\"><input type=\"number\" class=\"form-control\" min=\"0\" max=\"<?php echo (int)$maxPrice?>\" step=\"<?php echo (int)$priceStep?>\" name=\"price_to\" placeholder=\"До\" value=\"<?php echo htmlspecialchars($price2)?>\"></div>\n          </div>\n          <div class=\"catalog-filter__slider\" id=\"catalog-filter__slider\"></div>\n        </div>\n      </div>\n      <div class=\"col-sm-3\">\n        <div class=\"hidden-xs\"><label>&nbsp;</label></div>\n        <div class=\"catalog-filter__property catalog-filter__property_search\">\n          <button type=\"submit\" class=\"btn btn-primary\"><?php echo DO_SEARCH?></button>\n          <a href=\"<?php echo htmlspecialchars($Page->url)?>\" class=\"btn btn-default\"><?php echo RESET?></a>\n        </div>\n      </div>\n    </div>\n    <div class=\"row\">\n      <div class=\"col-sm-3\"></div>\n      <div class=\"col-sm-4\"></div>\n      <div class=\"col-sm-1\"></div>\n    </div>\n  </form>\n  <script src=\"/js/catalog_filter.js\"></script>\n</div>\n<!--/noindex-->\n',0),(39,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'cart_main','<?php\nnamespace RAAS\\CMS\\Shop;\n\n?>\n<!--noindex-->\n<a href=\"/cart/\" data-role=\"cart-block\" class=\"cart-main\" style=\"display: none\" rel=\"nofollow\">\n  <?php echo IN_YOUR_CART?><br />\n  <strong data-role=\"cart-block-amount\"></strong><br />\n  <?php echo TO_AMOUNT_OF?> <strong data-role=\"cart-block-sum\"></strong> <i class=\"fa fa-rub\"></i>\n</a>\n<!--/noindex-->\n',0),(40,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'favorites_main','<?php\nnamespace RAAS\\CMS\\Shop;\n\n?>\n<!--noindex-->\n<a href=\"/favorites/\" data-role=\"favorites-block\" class=\"favorites-main\" style=\"display: none\" rel=\"nofollow\">\n  <?php echo IN_FAVORITES?><br />\n  <strong data-role=\"favorites-block-amount\"></strong>\n</a>\n<!--/noindex-->\n',0),(41,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'menu_left','<?php\nnamespace RAAS\\CMS;\n\nuse SOME\\HTTP;\n\n$showMenu = function($node, Page $current) use (&$showMenu) {\n    static $level = 0;\n    if ($node instanceof Menu) {\n        $children = $node->visSubMenu;\n    } else {\n        $children = (isset($node[\'children\']) && is_array($node[\'children\'])) ? $node[\'children\'] : array();\n    }\n    for ($i = 0; $i < count($children); $i++) {\n        $row = $children[$i];\n        $level++;\n        $ch = $showMenu($row, $current);\n        $level--;\n        if ($node instanceof Menu) {\n            $url = $row->url;\n            $name = $row->name;\n        } else {\n            $url = $row[\'url\'];\n            $name = $row[\'name\'];\n        }\n        $active = ($url == HTTP::queryString(\'\', true));\n        $semiactive = preg_match(\'/^\' . preg_quote($url, \'/\') . \'/umi\', HTTP::queryString(\'\', true)) && ($url != \'/\') && !$active;\n        if (preg_match(\'/class=\"[\\\\w\\\\- ]*?active[\\\\w\\\\- ]*?\"/umi\', $ch)) {\n            $semiactive = true;\n        }\n        $liClasses = array(\n            \'menu-left__item\',\n            \'menu-left__item_\' . (!$level ? \'main\' : \'inner\'),\n            \'menu-left__item_level_\' . $level\n        );\n        $aClasses = array(\n            \'menu-left__link\',\n            \'menu-left__link_\' . (!$level ? \'main\' : \'inner\'),\n            \'menu-left__link_level_\' . $level\n        );\n        if ($active) {\n            $liClasses[] = \'menu-left__item_active\';\n            $aClasses[] = \'menu-left__link_active\';\n        } elseif ($semiactive) {\n            $liClasses[] = \'menu-left__item_semiactive\';\n            $aClasses[] = \'menu-left__link_semiactive\';\n        }\n        $text .= \'<li class=\"\' . implode(\' \', $liClasses) . \'\">\'\n              .  \'  <a class=\"\' . implode(\' \', $aClasses) . \'\" \' . ($active ? \'\' : \' href=\"\' . htmlspecialchars($url) . \'\"\') . \'>\' . htmlspecialchars($name) . \'</a>\'\n              .     $ch\n              .  \'</li>\';\n    }\n    $ulClasses = array(\n        \'menu-left__list\',\n        \'menu-left__list_\' . (!$level ? \'main\' : \'inner\'),\n        \'menu-left__list_level_\' . $level\n    );\n    return $text ? \'<ul class=\"\' . implode(\' \', $ulClasses) . \'\">\' . $text . \'</ul>\' : $text;\n};\n?>\n<div class=\"menu-left__outer left-block\">\n  <div class=\"menu-left__title left-block__title\">\n    <a href=\"/catalog/\"><?php echo CATALOG?></a>\n  </div>\n  <nav class=\"menu-left\"><?php echo $showMenu($menuArr ?: $Item, $Page)?></nav>\n</div>\n',0),(42,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'file_inc','<?php\nnamespace RAAS\\CMS\\Shop;\n\n$getFileIcon = function($row)\n{\n    $ext = pathinfo($row->fileURL, PATHINFO_EXTENSION);\n    switch ($ext) {\n        case \'zip\': case \'rar\': case \'tar\': case \'gz\': case \'7z\':\n            $icon = \'archive\';\n            break;\n        case \'mp3\': case \'wav\': case \'ogg\': case \'mid\': case \'rmi\':\n            $icon = \'audio\';\n            break;\n        case \'php\': case \'html\': case \'cs\': case \'class\': case \'inc\': case \'js\': case \'css\':\n            $icon = \'code\';\n            break;\n        case \'jpg\': case \'gif\': case \'jpeg\': case \'pjpeg\': case \'bmp\': case \'tif\': case \'tiff\':\n            $icon = \'picture\';\n            break;\n        case \'pdf\':\n            $icon = \'pdf\';\n            break;\n        case \'ppt\': case \'pptx\':\n            $icon = \'powerpoint\';\n            break;\n        case \'avi\': case \'mpg\': case \'flv\':\n            $icon = \'video\';\n            break;\n        case \'doc\': case \'docx\': case \'rft\':\n            $icon = \'word\';\n            break;\n        default:\n            $icon = \'text\';\n            break;\n    }\n    return \'fa-file-\' . htmlspecialchars($icon) . \'-o\';\n};\n',0),(43,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'spec','<?php\nnamespace RAAS\\CMS;\n\n$MType = Material_Type::importByURN(\'catalog\');\n$Field = $MType->fields[\'spec\'];\n$SQL_query = \"SELECT tM.* FROM \" . Material::_tablename() . \" AS tM\n                JOIN cms_data AS tD ON tD.pid = tM.id\n               WHERE tD.fid = \" . (int)$Field->id . \" AND tM.pid IN (\" . implode(\", \", array_merge(array((int)$MType->id), (array)$MType->all_children_ids)) . \")\n            GROUP BY tM.id\n            ORDER BY RAND()\n               LIMIT 20\";\n$Set = Material::getSQLSet($SQL_query);\neval(\'?\' . \'>\' . Snippet::importByURN(\'item_inc\')->description);\n?>\n<?php if ($Set) { ?>\n    <div class=\"spec\">\n      <div class=\"spec__list\" data-role=\"slider\" data-slider-carousel=\"jcarousel\" data-slider-duration=\"800\" data-slider-interval=\"3000\" data-slider-autoscroll=\"true\">\n        <div class=\"spec-list\">\n          <?php foreach ((array)$Set as $row) { ?>\n              <div class=\"spec-list__item\">\n                <?php $showItem($row); ?>\n              </div>\n          <?php } ?>\n        </div>\n      </div>\n      <a href=\"#\" class=\"spec__arrow spec__arrow_left\" data-role=\"slider-prev\"></a>\n      <a href=\"#\" class=\"spec__arrow spec__arrow_right\" data-role=\"slider-next\"></a>\n    </div>\n<?php } ?>\n',0),(44,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'my_orders','<?php\nnamespace RAAS\\CMS\\Shop;\n\nfunction formatPrice($price)\n{\n    $remainder = (float)$price - (float)(int)$price;\n    return str_replace(\' \', \'&nbsp;\', number_format((float)$price, ($remainder > 0) ? 2 : 0, \',\', \' \' ));\n}\n\n$getField = function($row) {\n    $arr = array();\n    $val = $row->doRich();\n    switch ($row->datatype) {\n        case \'date\':\n            $arr[$key] = date(DATEFORMAT, strtotime($val));\n            break;\n        case \'datetime-local\':\n            $arr[$key] = date(DATETIMEFORMAT, strtotime($val));\n            break;\n        case \'color\':\n            $arr[$key] = \'<span style=\"display: inline-block; height: 16px; width: 16px; background-color: \' . htmlspecialchars($val) . \'\"></span>\';\n            break;\n        case \'email\':\n            $arr[$key] .= \'<a href=\"mailto:\' . htmlspecialchars($val) . \'\">\' . htmlspecialchars($val) . \'</a>\';\n            break;\n        case \'url\':\n            $arr[$key] .= \'<a href=\"\' . (!preg_match(\'/^http(s)?:\\\\/\\\\//umi\', trim($val)) ? \'http://\' : \'\') . htmlspecialchars($val) . \'\">\' . htmlspecialchars($val) . \'</a>\';\n            break;\n        case \'file\':\n            $arr[$key] .= \'<a href=\"/\' . $val->fileURL . \'\">\' . htmlspecialchars($val->name) . \'</a>\';\n            break;\n        case \'image\':\n            $arr[$key] .= \'<a href=\"/\' . $val->fileURL . \'\"><img src=\"/\' . $val->tnURL. \'\" alt=\"\' . htmlspecialchars($val->name) . \'\" title=\"\' . htmlspecialchars($val->name) . \'\" /></a>\';\n            break;\n        case \'htmlarea\':\n            $arr[$key] = \'<div>\' . $val . \'</div>\';\n            break;\n        default:\n            if (!$row->multiple && ($row->datatype == \'checkbox\')) {\n                $arr[$key] = $val ? _YES : _NO;\n            } else {\n                $arr[$key] = nl2br(htmlspecialchars($val));\n            }\n            break;\n    }\n    return implode(\', \', $arr);\n};\n\n?>\n<div class=\"my-orders\">\n  <?php if ($Item) { ?>\n      <?php if (!$Item->status_id && !$Item->paid && !$Item->vis) { ?>\n          <p class=\"text-right\">\n            <a href=\"#\" data-id=\"<?php echo (int)$Item->id?>\" data-toggle=\"modal\" data-target=\"#confirmDeleteOrderModal\"><span class=\"fa fa-close\"></span> Удалить заказ</a>\n          </p>\n      <?php } ?>\n      <div class=\"form-horizontal\">\n        <div data-role=\"feedback-form\">\n          <div class=\"form-group\">\n            <label class=\"control-label col-sm-3 col-md-2\" style=\"padding-top: 0\"><?php echo STATUS?>:</label>\n            <div class=\"col-sm-9 col-md-4\"><?php echo $Item->paid ? PAYMENT_PAID : PAYMENT_NOT_PAID?></div>\n          </div>\n          <?php\n          foreach ($Item->fields as $row) {\n              if ($val = $getField($row)) {\n                  ?>\n                  <div class=\"form-group\">\n                    <label class=\"control-label col-sm-3 col-md-2\" style=\"padding-top: 0\"><?php echo htmlspecialchars($row->name)?>:</label>\n                    <div class=\"col-sm-9 col-md-4\"><?php echo $val?></div>\n                  </div>\n                  <?php\n              }\n          }\n          ?>\n        </div>\n      </div>\n      <p>&nbsp;</p>\n      <table class=\"table table-striped cart-table\" data-role=\"cart-table\">\n        <tbody>\n          <?php $sum = $am = 0; foreach ($Item->items as $row) {?>\n            <tr data-role=\"cart-item\">\n              <td class=\"cart-table__image-col\">\n                <?php if ($row->visImages) { ?>\n                    <a <?php echo $row->url ? \'href=\"\' . htmlspecialchars($row->url) . \'\"\' : \'\'?>>\n                      <img src=\"/<?php echo htmlspecialchars(addslashes($row->visImages[0]->tnURL))?>\" alt=\"<?php echo htmlspecialchars($row->visImages[0]->name ?: $row->name)?>\" /></a>\n                <?php } ?>\n              </td>\n              <td class=\"cart-table__name-col\">\n                <h3><a <?php echo $row->url ? \'href=\"\' . htmlspecialchars($row->url) . \'\"\' : \'\'?>><?php echo htmlspecialchars($row->name)?></a></h3>\n                <?php if ($Cart->cartType->no_amount) { ?>\n                    <input type=\"hidden\" name=\"amount[<?php echo htmlspecialchars((int)$row->id . \'_\' . $row->meta)?>]\" value=\"<?php echo (int)$row->amount?>\" />\n                <?php } else { ?>\n                    <p><?php echo AMOUNT . \': \' . (int)$row->amount?></p>\n                    <?php\n                }\n                foreach ($row->fields as $f) {\n                    if ($val = array_filter(array_map(array($f, \'doRich\'), $f->getValues(true)))) {\n                        ?>\n                        <p>\n                          <?php echo htmlspecialchars($f->name)?>:\n                          <?php\n                          if (in_array($key, array(\'metal\'))) {\n                              echo htmlspecialchars(mb_strtolower(implode(\', \', $val)));\n                          } else {\n                              echo htmlspecialchars(implode(\', \', $val));\n                          }\n                          ?>\n                        </p>\n                        <?php\n                    }\n                }\n                ?>\n              </td>\n              <td class=\"cart-table__sum-col\"><span data-role=\"sum\"><?php echo formatPrice($row->amount * $row->realprice)?></span> <span class=\"fa fa-rub\"></span></td>\n            </tr>\n          <?php $sum += $row->amount * $row->realprice; $am += $row->amount; } ?>\n          <tr>\n            <th class=\"cart-table__image-col\"></th>\n            <th class=\"cart-table__name-col\"><?php echo TOTAL_SUM?>:</th>\n            <th class=\"cart-table__sum-col\"><span data-role=\"total-sum\"><?php echo formatPrice($sum)?></span>&nbsp;<span class=\"fa fa-rub\"></span></th>\n          </tr>\n        </tbody>\n      </table>\n\n  <?php } elseif ($Set) { ?>\n      <table class=\"table table-striped my-orders__table\">\n        <tbody>\n          <?php foreach ($Set as $row) { ?>\n              <tr>\n                <td><a href=\"<?php echo $row->urn?>/\"><?php echo Lang::i()->_(\'ORDER_NUMBER\', $Page)?> <?php echo (int)$row->id?></td>\n                <td><a href=\"<?php echo $row->urn?>/\"><?php echo date(Lang::i()->_(\'DATETIME_FORMAT\', $Page), strtotime($row->post_date))?></a></td>\n                <td>\n                  <a href=\"<?php echo $row->urn?>/\">\n                  <?php\n                  $temp = array();\n                  foreach ($row->items as $row2) {\n                      $arr = $row2->name;\n                      if ($row2->amount > 1) {\n                          $arr .= \' - \' . (int)$row2->amount . \'x\' . formatPrice($row2->realprice) . \'<span class=\"fa fa-rub\"></span> = \' . formatPrice($row2->amount * $row2->realprice) . \' <span class=\"fa fa-rub\"></span>\';\n                      } else {\n                          $arr .= \' = \' . formatPrice($row2->realprice) . \' <span class=\"fa fa-rub\"></span>\';\n                      }\n                      $temp[] = $arr;\n                  }\n                  echo implode(\'<br />\', $temp);\n                  ?>\n                  </a>\n                </td>\n                <td>\n                  <?php\n                  $temp = array();\n                  if ($row->status->id) {\n                      $temp[] = $row->status->name;\n                  } else {\n                      // $temp[] = ORDER_STATUS_NEW;\n                  }\n                  if ($row->paid) {\n                      $temp[] = PAYMENT_PAID;\n                  } else {\n                      $temp[] = PAYMENT_NOT_PAID;\n                  }\n                  echo implode(\'<br />\', $temp);\n                  ?>\n                </td>\n                <td class=\"my-orders__sum\">\n                  <a href=\"<?php echo $row->urn?>/\"><?php echo formatPrice($row->sum)?> <span class=\"fa fa-rub\"></span></a>\n                </td>\n                <td>\n                  <?php if (!$row->status_id && !$row->paid && !$row->vis) { ?>\n                      <a href=\"#\" data-id=\"<?php echo (int)$row->id?>\" data-back=\"true\" data-toggle=\"modal\" data-target=\"#confirmDeleteOrderModal\"><span class=\"fa fa-close\"></span></a>\n                  <?php } ?>\n                </td>\n              </tr>\n          <?php } ?>\n        </tbody>\n      </table>\n  <?php } else { ?>\n    <p><?php echo Lang::i()->_(\'YOU_HAVE_NO_ORDERS_YET\', $Page)?></p>\n  <?php } ?>\n</div>\n\n<div class=\"modal fade\" id=\"confirmDeleteOrderModal\" tabindex=\"-1\" role=\"dialog\">\n  <div class=\"modal-dialog\" role=\"document\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\" style=\"border-bottom: none\">\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n        <h4 class=\"modal-title\"><?php echo Lang::i()->_(\'ARE_YOU_SURE_TO_DELETE_THIS_ORDER\', $Page)?></h4>\n      </div>\n      <div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\"><?php echo CANCEL?></button>\n        <a href=\"#\" class=\"btn btn-primary\"><?php echo DELETE?></a>\n      </div>\n    </div>\n  </div>\n</div>\n\n<script>\njQuery(document).ready(function($) {\n    var $confirmDeleteOrderModal = $(\'#confirmDeleteOrderModal\');\n    $(\'body\').append(\'confirmDeleteOrderModal\');\n    $(\'a[data-target=\"#confirmDeleteOrderModal\"][data-toggle=\"modal\"]\').on(\'click\', function() {\n        $(\'.modal-footer a\').attr(\'href\', \'?action=delete&id=\' + parseInt($(this).attr(\'data-id\')) + ($(this).attr(\'data-back\') ? \'&back=1\' : \'\'));\n    });\n});\n</script>\n',0),(45,1,'0000-00-00 00:00:00','2024-04-04 10:06:59',0,1,'__raas_users_register_interface','<?php\r\n/**\r\n * Стандартный интерфейс регистрации\r\n * @param Block_Register $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS\\Users;\r\n\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new RegisterInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(46,1,'0000-00-00 00:00:00','2024-04-04 10:06:59',0,1,'__raas_users_activation_interface','<?php\r\n/**\r\n * Стандартный интерфейс активации учетной записи\r\n * @param Block_Activation $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS\\Users;\r\n\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new ActivationInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(47,1,'0000-00-00 00:00:00','2024-04-04 10:06:59',0,1,'__raas_users_login_interface','<?php\r\n/**\r\n * Стандартный интерфейс входа в систему\r\n * @param Block_LogIn $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS\\Users;\r\n\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new LogInInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(48,1,'0000-00-00 00:00:00','2024-04-04 10:06:59',0,1,'__raas_users_recovery_interface','<?php\r\n/**\r\n * Стандартный интерфейс восстановления пароля\r\n * @param Block_Recovery $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS\\Users;\r\n\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new RecoveryInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(49,1,'0000-00-00 00:00:00','2024-04-04 10:06:59',0,1,'__raas_users_register_notify','<?php\r\n/**\r\n * Уведомление о регистрации\r\n * @param bool $SMS Уведомление отправляется по SMS\r\n * @param Form $Form Форма регистрации\r\n * @param bool $ADMIN Отправка сообщения для администратора\r\n *     (если false то для пользователя)\r\n * @param User $User Пользователь\r\n * @param array $config Конфигурация блока\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS\\Users;\r\n\r\nuse RAAS\\Controller_Frontend as ControllerFrontend;\r\nuse RAAS\\CMS\\NotificationFieldRenderer;\r\nuse RAAS\\CMS\\Users\\Block_Register;\r\nuse RAAS\\CMS\\Users\\Block_Activation;\r\n\r\n$cf = ControllerFrontend::i();\r\n$adminUrl = $cf->schemeHost . \'/admin/?p=cms\';\r\n\r\n$page = $User->page;\r\n\r\nif ($ADMIN) {\r\n    $headerTemplate = NEW_USER_REGISTERED_ON_SITE;\r\n} else {\r\n    $headerTemplate = YOU_HAVE_SUCCESSFULLY_REGISTERED_ON_WEBSITE;\r\n}\r\nif ($SMS) {\r\n    if ($ADMIN) {\r\n        echo sprintf($headerTemplate, $cf->schemeHost, $cf->idnHost) . \"\\n\";\r\n    }\r\n    $passwordDetected = false;\r\n    foreach ($Form->fields as $field) {\r\n        if ($field->datatype == \'password\') {\r\n            $passwordDetected = true;\r\n            if ($ADMIN) {\r\n                continue;\r\n            }\r\n        }\r\n        $renderer = NotificationFieldRenderer::spawn($field, $User);\r\n        echo $renderer->render([\'admin\' => $ADMIN, \'sms\' => true]);\r\n    }\r\n    if (!$passwordDetected && !$ADMIN && $User->password) {\r\n        echo PASSWORD . \': \' . htmlspecialchars($User->password) . \"\\n\";\r\n    }\r\n} else { ?>\r\n    <p>\r\n      <?php echo sprintf($headerTemplate, $cf->schemeHost, $cf->idnHost)?>\r\n    </p>\r\n    <div>\r\n      <?php\r\n      if (!$ADMIN) {\r\n          $fields = $Form->visFields;\r\n      } else {\r\n          $fields = $Form->fields;\r\n      }\r\n      $passwordDetected = false;\r\n      foreach ($fields as $field) {\r\n          if ($field->datatype == \'password\') {\r\n              $passwordDetected = true;\r\n              if ($ADMIN) {\r\n                  continue;\r\n              }\r\n          }\r\n          $renderer = NotificationFieldRenderer::spawn($field, $User);\r\n          echo $renderer->render([\'admin\' => $ADMIN, \'sms\' => false]);\r\n      }\r\n      if (!$passwordDetected && !$ADMIN && $User->password) {\r\n          echo \'<div>\' . PASSWORD . \': \' . htmlspecialchars($User->password) . \'</div>\';\r\n      }\r\n      ?>\r\n    </div>\r\n    <?php if ($ADMIN) {\r\n        if ($User && $User->id) { ?>\r\n            <p>\r\n              <a href=\"<?php echo htmlspecialchars($adminUrl . \'&m=users&action=edit&id=\' . (int)$User->id)?>\">\r\n                <?php echo VIEW?>\r\n              </a>\r\n            </p>\r\n        <?php } ?>\r\n        <p>\r\n          <small>\r\n            <?php\r\n            echo IP_ADDRESS . \': \' .\r\n                htmlspecialchars((string)$User->ip) . \'<br />\' .\r\n                USER_AGENT . \': \' .\r\n                htmlspecialchars((string)$User->user_agent) . \'<br />\' .\r\n                PAGE . \': \';\r\n            if ($page->parents) {\r\n                foreach ($page->parents as $row) { ?>\r\n                    <a href=\"<?php echo htmlspecialchars($adminUrl . \'&id=\' . (int)$row->id)?>\">\r\n                      <?php echo htmlspecialchars($row->name)?>\r\n                    </a> /\r\n                <?php }\r\n            } ?>\r\n            <a href=\"<?php echo htmlspecialchars($adminUrl . \'&id=\' . (int)$page->id)?>\">\r\n              <?php echo htmlspecialchars($page->name)?>\r\n            </a>\r\n          </small>\r\n        </p>\r\n    <?php } else {\r\n        switch ($config[\'activation_type\']) {\r\n            case Block_Register::ACTIVATION_TYPE_ALREADY_ACTIVATED:\r\n                echo \'<p>\' . NOW_YOU_CAN_LOG_IN_INTO_THE_SYSTEM . \'</p>\';\r\n                break;\r\n            case Block_Register::ACTIVATION_TYPE_ADMINISTRATOR:\r\n                echo \'<p>\' . PLEASE_WAIT_FOR_ADMINISTRATOR_TO_ACTIVATE . \'</p>\';\r\n                break;\r\n            case Block_Register::ACTIVATION_TYPE_USER:\r\n                $activationBlocks = Block_Activation::getSet([\r\n                    \'where\' => \"block_type = \'RAAS\\\\\\\\CMS\\\\\\\\Users\\\\\\\\Block_Activation\'\",\r\n                    \'orderBy\' => \"id\"\r\n                ]);\r\n                $activationPages = [];\r\n                if ($activationBlocks) {\r\n                    $activationPages = [];\r\n                    foreach ($activationBlocks as $activationBlock) {\r\n                        $activationPages = array_merge(\r\n                            $activationPages,\r\n                            $activationBlock->pages\r\n                        );\r\n                    }\r\n                }\r\n                $p = $Page->parent;\r\n                $activationPage = null;\r\n                while ($p->id) {\r\n                    $nearestActivationPages = array_filter(\r\n                        $activationPages,\r\n                        function ($x) use ($p) {\r\n                            return $x->pid == $p->id;\r\n                        }\r\n                    );\r\n                    if ($nearestActivationPages) {\r\n                        $activationPage = array_shift($nearestActivationPages);\r\n                        break;\r\n                    }\r\n                    $p = $p->parent;\r\n                }\r\n                if (!$activationPage->id && $activationPages) {\r\n                    $activationPage = array_shift($activationPages);\r\n                }\r\n                if ($activationPage->id) {\r\n                    $url = $cf->schemeHost . $activationPage->url\r\n                        . \'?key=\' . $User->activationKey;\r\n                    echo \'<p>\' . sprintf(ACTIVATION_LINK, $url, $url) . \'</p>\';\r\n                }\r\n                break;\r\n        }\r\n        ?>\r\n        <p>--</p>\r\n        <p>\r\n          <?php echo WITH_RESPECT . \',<br />\' . ADMINISTRATION_OF_SITE?>\r\n          <a href=\"<?php echo htmlspecialchars($cf->schemeHost)?>\">\r\n            <?php echo htmlspecialchars($cf->idnHost)?>\r\n          </a>\r\n        </p>\r\n        <?php\r\n    }\r\n}\r\n',1),(50,1,'0000-00-00 00:00:00','2024-04-04 10:06:59',0,1,'__raas_users_recovery_notify','<?php\n/**\n * Уведомление о восстановлении пароля\n * @param Page $Page Текущая страница\n * @param User $User Пользователь\n */\nnamespace RAAS\\CMS;\n\nuse RAAS\\Controller_Frontend as ControllerFrontend;\n\n$cf = ControllerFrontend::i();\n$link = $Page->url . \'?key=\' . $User->recoveryKey;\nif ($referer) {\n    $link .= \'&HTTP_REFERER=\' . urlencode($referer);\n}\n?>\n<p>\n  <?php\n  echo date(DATETIMEFORMAT) . \' \' .\n      sprintf(\n          YOU_HAVE_ASKED_PASSWORD_RECOVERY_ON_SITE,\n          $cf->schemeHost,\n          $cf->idnHost\n      );\n  ?>\n</p>\n<p>\n  <?php\n  echo sprintf(\n      RECOVERY_LINK,\n      $cf->schemeHost . $link,\n      $cf->idnSchemeHost . $link\n  )?>\n</p>\n<p>\n  <?php echo IF_IT_WAS_NOT_YOU_JUST_IGNORE?>\n</p>\n\n<p>--</p>\n<p>\n  <?php echo WITH_RESPECT?>,<br />\n  <?php echo ADMINISTRATION_OF_SITE?>\n  <a href=\"<?php echo htmlspecialchars($cf->schemeHost)?>\">\n    <?php echo htmlspecialchars($cf->idnHost)?>\n  </a>\n</p>\n',1),(51,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'register','<?php\nnamespace RAAS\\CMS\\Users;\n\nuse RAAS\\CMS\\Feedback;\nuse RAAS\\CMS\\SocialProfile;\n\nif ($_POST[\'AJAX\']) {\n    $result = array();\n    if ($success[(int)$Block->id]) {\n        $result[\'success\'] = 1;\n    }\n    if ($localError) {\n        $result[\'localError\'] = $localError;\n    }\n    if ($social) {\n        $result[\'social\'] = trim($social);\n    }\n    if ($social) {\n        $result[\'socialNetwork\'] = trim($socialNetwork);\n    }\n    ob_clean();\n    echo json_encode($result);\n    exit;\n} else { ?>\n    <a name=\"feedback\"></a>\n    <div class=\"feedback\">\n      <form class=\"form-horizontal\" <?php /*data-role=\"raas-ajaxform\"*/?> action=\"\" method=\"post\" enctype=\"multipart/form-data\">\n        <?php include \\RAAS\\CMS\\Package::i()->resourcesDir . \'/form2.inc.php\'?>\n        <div data-role=\"notifications\" <?php echo ($success[(int)$Block->id] || $localError) ? \'\' : \'style=\"display: none\"\'?>>\n          <div class=\"alert alert-success\" <?php echo ($success[(int)$Block->id]) ? \'\' : \'style=\"display: none\"\'?>>\n            <?php\n            echo YOU_HAVE_SUCCESSFULLY_REGISTERED . \' \';\n            switch ($config[\'activation_type\']) {\n                case Block_Register::ACTIVATION_TYPE_ALREADY_ACTIVATED:\n                    echo NOW_YOU_CAN_LOG_IN_INTO_THE_SYSTEM;\n                    break;\n                case Block_Register::ACTIVATION_TYPE_ADMINISTRATOR:\n                    echo PLEASE_WAIT_FOR_ADMINISTRATOR_TO_ACTIVATE;\n                    break;\n                case Block_Register::ACTIVATION_TYPE_USER:\n                    echo PLEASE_ACTIVATE_BY_EMAIL;\n                    break;\n            }\n            ?>\n          </div>\n          <div class=\"alert alert-danger\" <?php echo ($localError) ? \'\' : \'style=\"display: none\"\'?>>\n            <ul>\n              <?php foreach ((array)$localError as $key => $val) { ?>\n                  <li><?php echo htmlspecialchars($val)?></li>\n              <?php } ?>\n            </ul>\n          </div>\n        </div>\n\n        <div data-role=\"feedback-form\" <?php echo $success[(int)$Block->id] ? \'style=\"display: none\"\' : \'\'?>>\n          <p><?php echo ASTERISK_MARKED_FIELDS_ARE_REQUIRED?></p>\n          <?php if ($Form->signature) { ?>\n                <input type=\"hidden\" name=\"form_signature\" value=\"<?php echo md5(\'form\' . (int)$Form->id . (int)$Block->id)?>\" />\n          <?php } ?>\n          <?php if ($Form->antispam == \'hidden\' && $Form->antispam_field_name && !$User->id) { ?>\n                <input type=\"text\" autocomplete=\"off\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" value=\"<?php echo htmlspecialchars($DATA[$Form->antispam_field_name])?>\" style=\"position: absolute; left: -9999px\" />\n          <?php } ?>\n          <?php foreach ($Form->fields as $row) { ?>\n              <div class=\"form-group\">\n                <label<?php echo !$row->multiple ? \' for=\"\' . htmlspecialchars($row->urn . $row->id . \'_\' . $Block->id) . \'\"\' : \'\'?> class=\"control-label col-sm-3\"><?php echo htmlspecialchars($row->name . ($row->required ? \'*\' : \'\'))?></label>\n                <div class=\"col-sm-9 col-md-4\"><?php $getField($row, $DATA)?></div>\n              </div>\n          <?php } ?>\n          <?php if ($config[\'allow_edit_social\']) { ?>\n              <style type=\"text/css\">\n              .raas-social { display: inline-block; width: 16px; height: 16px; background-image: url(\'http://ulogin.ru/img/small.png?version=1.3.00\'); }\n              .raas-social<?php echo SocialProfile::SN_VK?> { background-position: 0 -19px; }\n              .raas-social<?php echo SocialProfile::SN_FB?> { background-position: 0 -88px; }\n              .raas-social<?php echo SocialProfile::SN_OK?> { background-position: 0 -42px; }\n              .raas-social<?php echo SocialProfile::SN_MR?> { background-position: 0 -65px; }\n              .raas-social<?php echo SocialProfile::SN_TW?> { background-position: 0 -111px; }\n              .raas-social<?php echo SocialProfile::SN_LJ?> { background-position: 0 -180px; }\n              .raas-social<?php echo SocialProfile::SN_GO?> { background-position: 0 -134px; }\n              .raas-social<?php echo SocialProfile::SN_YA?> { background-position: 0 -157px; }\n              .raas-social<?php echo SocialProfile::SN_WM?> { background-position: 0 -410px; }\n              .raas-social<?php echo SocialProfile::SN_YT?> { background-position: 0 -433px; }\n              </style>\n              <script src=\"//ulogin.ru/js/ulogin.js\"></script>\n              <div class=\"col-sm-offset-3 col-sm-9 col-md-6\" style=\"margin-bottom: 25px\">\n                <h3><?php echo SOCIAL_NETWORKS?></h3>\n                <div data-role=\"raas-social-network-container\" style=\"margin: 20px 0\">\n                  <?php foreach ((array)$DATA[\'social\'] as $i => $temp) { ?>\n                      <div data-role=\"raas-repo-element\" class=\"clearfix\">\n                        <input type=\"hidden\" name=\"social[]\" value=\"<?php echo htmlspecialchars($temp)?>\" />\n                        <a href=\"<?php echo htmlspecialchars($temp)?>\" target=\"_blank\">\n                          <span class=\"raas-social raas-social<?php echo (int)SocialProfile::getSocialNetwork($temp)?>\"></span>\n                          <?php echo htmlspecialchars($temp)?>\n                        </a>\n                        <a href=\"#\" class=\"close\" style=\"float: right;\" data-role=\"raas-repo-del\">&times;</a>\n                      </div>\n                  <?php } ?>\n                </div>\n                <div id=\"uLogin\" data-ulogin=\"display=panel;fields=first_name,last_name;providers=vkontakte,odnoklassniki,mailru,facebook;hidden=twitter,google,yandex,livejournal,youtube,webmoney;redirect_uri=;callback=RAAS_CMS_social_login\"></div>\n              </div>\n              <script>\n              jQuery(document).ready(function($) {\n                  $(\'[data-role=\"raas-social-network-container\"]\').on(\'click\', \'[data-role=\"raas-repo-del\"]\', function() {\n                      $(this).closest(\'[data-role=\"raas-repo-element\"]\').remove();\n                      return false;\n                  });\n                  RAAS_CMS_social_login = function(token)\n                  {\n                      $.post(location.toString(), {\'token\': token, \'AJAX\': 1}, function(data) {\n                          var isFound = false;\n                          $(\'[data-role=\"raas-social-network-container\"] input:hidden\').each(function() {\n                              if ($.trim($(this).val()) == $.trim(data.social)) {\n                                  isFound = true;\n                              }\n                          });\n                          if (!isFound) {\n                              var text = \'<div data-role=\"raas-repo-element\" class=\"clearfix\">\'\n                                       + \'  <input type=\"hidden\" name=\"social[]\" value=\"\' + data.social + \'\" />\'\n                                       + \'  <a href=\"\' + data.social + \'\" target=\"_blank\"><span class=\"raas-social raas-social\' + data.socialNetwork + \'\"></span> \' + data.social + \'</a>\'\n                                       + \'  <a href=\"#\" class=\"close\" style=\"float: right;\" data-role=\"raas-repo-del\">&times;</a>\'\n                                       + \'</div>\';\n                              $(\'[data-role=\"raas-social-network-container\"]\').append(text);\n                          }\n                      }, \'json\');\n                  }\n              });\n              </script>\n          <?php } ?>\n          <?php if ($Form->antispam == \'captcha\' && $Form->antispam_field_name && !$User->id) { ?>\n              <div class=\"form-group\">\n                <label for=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" class=\"control-label col-sm-3\"><?php echo CAPTCHA?></label>\n                <div class=\"col-sm-9 col-md-4\">\n                  <img src=\"/assets/kcaptcha/?<?php echo session_name() . \'=\' . session_id()?>\" /><br />\n                  <input type=\"text\" name=\"<?php echo htmlspecialchars($Form->antispam_field_name)?>\" class=\"form-control\" />\n                </div>\n              </div>\n          <?php } ?>\n          <div class=\"form-group\">\n            <div class=\"col-sm-9 col-md-4 col-sm-offset-3\"><button class=\"btn btn-primary\" type=\"submit\"><?php echo $User->id ? SAVE : DO_REGISTER?></button></div>\n          </div>\n        </div>\n      </form>\n    </div>\n<?php } ?>\n',0),(52,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'activation','<?php\nnamespace RAAS\\CMS\\Users;\n\nif ($_POST[\'AJAX\']) {\n    $result = array();\n    if ($success) {\n        $result[\'success\'] = 1;\n    }\n    if ($localError) {\n        $result[\'localError\'] = $localError;\n    }\n    ob_clean();\n    echo json_encode($result);\n    exit;\n} else {\n    ?>\n    <div data-role=\"notifications\">\n      <div class=\"alert alert-success\" <?php echo ($success) ? \'\' : \'style=\"display: none\"\'?>><?php echo YOUR_ACCOUNT_HAS_BEEN_SUCCESSFULLY_ACTIVATED?></div>\n      <div class=\"alert alert-danger\" <?php echo ($localError) ? \'\' : \'style=\"display: none\"\'?>>\n        <ul>\n          <?php foreach ((array)$localError as $key => $val) { ?>\n              <li><?php echo htmlspecialchars($val)?></li>\n          <?php } ?>\n        </ul>\n      </div>\n    </div>\n    <?php\n}\n',0),(53,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'login','<?php\nnamespace RAAS\\CMS\\Users;\n\nif ($_POST[\'AJAX\']) {\n    $result = array();\n    if ($success[(int)$Block->id]) {\n        $result[\'success\'] = 1;\n    }\n    if ($localError) {\n        $result[\'localError\'] = $localError;\n    }\n    if ($social) {\n        $result[\'social\'] = trim($social);\n    }\n    if ($social) {\n        $result[\'socialNetwork\'] = trim($socialNetwork);\n    }\n    if ($User) {\n        $result[\'User\'] = $User->getArrayCopy();\n        $result[\'User\'][\'last_name\'] = $User->last_name;\n        $result[\'User\'][\'first_name\'] = $User->first_name;\n        $result[\'User\'][\'full_name\'] = $User->full_name;\n    }\n    ob_clean();\n    echo json_encode($result);\n    exit;\n} else {\n    ?>\n    <div class=\"feedback\">\n      <form class=\"form-horizontal\" method=\"post\" enctype=\"multipart/form-data\">\n        <div data-role=\"notifications\" <?php echo ($success || $localError) ? \'\' : \'style=\"display: none\"\'?>>\n          <div class=\"alert alert-danger\" <?php echo ($localError) ? \'\' : \'style=\"display: none\"\'?>>\n            <ul>\n              <?php foreach ((array)$localError as $key => $val) { ?>\n                  <li><?php echo htmlspecialchars($val)?></li>\n              <?php } ?>\n            </ul>\n          </div>\n        </div>\n        <div data-role=\"feedback-form\" <?php echo $success ? \'style=\"display: none\"\' : \'\'?>>\n          <div class=\"form-group\">\n            <label for=\"login_<?php echo (int)$Block->id?>\" class=\"control-label col-sm-3 col-md-2\"><?php echo LOGIN?>:</label>\n            <div class=\"col-sm-9 col-md-4\"><input type=\"text\" class=\"form-control\" name=\"login\" id=\"login_<?php echo (int)$Block->id?>\" /></div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"password_<?php echo (int)$Block->id?>\" class=\"control-label col-sm-3 col-md-2\"><?php echo PASSWORD?>:</label>\n            <div class=\"col-sm-9 col-md-4\"><input type=\"password\" class=\"form-control\" name=\"password\" id=\"password_<?php echo (int)$Block->id?>\" /></div>\n          </div>\n          <?php if (($config[\'password_save_type\'] == Block_LogIn::SAVE_PASSWORD_SAVE_PASSWORD) || ($config[\'password_save_type\'] == Block_LogIn::SAVE_PASSWORD_FOREIGN_COMPUTER)) { ?>\n              <div class=\"form-group\">\n                <div class=\"col-sm-9 col-md-4 col-sm-offset-3 col-md-offset-2\">\n                  <label>\n                    <?php if ($config[\'password_save_type\'] == Block_LogIn::SAVE_PASSWORD_SAVE_PASSWORD) { ?>\n                        <input type=\"checkbox\" name=\"save_password\" value=\"1\" /> <?php echo SAVE_PASSWORD?>\n                    <?php } elseif ($config[\'password_save_type\'] == Block_LogIn::SAVE_PASSWORD_FOREIGN_COMPUTER) { ?>\n                        <input type=\"checkbox\" name=\"foreign_computer\" value=\"1\" /> <?php echo FOREIGN_COMPUTER?>\n                    <?php } ?>\n                  </label>\n                </div>\n              </div>\n          <?php } ?>\n          <div class=\"form-group\">\n            <label class=\"control-label col-sm-3 col-md-2\">&nbsp;</label>\n            <div class=\"col-sm-9 col-md-4\"><a href=\"/recovery/\"><?php echo LOST_PASSWORD?></a></div>\n          </div>\n          <?php if ($config[\'social_login_type\']) { ?>\n              <div class=\"col-sm-offset-3 col-md-offset-2\" style=\"margin-bottom: 25px\">\n                <script src=\"//ulogin.ru/js/ulogin.js\"></script>\n                <div id=\"uLogin\" data-ulogin=\"display=panel;optional=first_name,last_name,phone,email,sex,nickname,bdate,city,country;providers=vkontakte,odnoklassniki,mailru,facebook;hidden=twitter,google,yandex,livejournal,youtube,webmoney;redirect_uri=<?php echo urlencode(\'http\' . ($_SERVER[\'HTTPS\'] == \'on\' ? \'s\' : \'\') . \'://\' . $_SERVER[\'HTTP_HOST\'] . $_SERVER[\'REQUEST_URI\'])?>\"></div>\n              </div>\n          <?php } ?>\n          <div class=\"form-group\"><div class=\"col-sm-9 col-md-4 col-sm-offset-3 col-md-offset-2\"><button class=\"btn btn-primary\" type=\"submit\"><?php echo DO_LOGIN?></button></div></div>\n        </div>\n      </form>\n    </div>\n<?php } ?>\n',0),(54,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'recovery','<?php\nnamespace RAAS\\CMS\\Users;\n\nif ($_POST[\'AJAX\']) {\n    $result = array();\n    if ($success) {\n        $result[\'success\'] = 1;\n    }\n    if ($localError) {\n        $result[\'localError\'] = $localError;\n    }\n    ob_clean();\n    echo json_encode($result);\n    exit;\n} else {\n    ?>\n    <div class=\"feedback\">\n      <form class=\"form-horizontal\" method=\"post\" enctype=\"multipart/form-data\">\n        <div data-role=\"notifications\" <?php echo ($success || $localError) ? \'\' : \'style=\"display: none\"\'?>>\n          <div class=\"alert alert-success\" <?php echo ($success) ? \'\' : \'style=\"display: none\"\'?>>\n            <?php echo $proceed ? YOUR_PASSWORD_WAS_SUCCESSFULLY_CHANGED : RECOVERY_KEY_WAS_SENT?>\n          </div>\n          <div class=\"alert alert-danger\" <?php echo ($localError) ? \'\' : \'style=\"display: none\"\'?>>\n            <ul>\n              <?php foreach ((array)$localError as $key => $val) { ?>\n                  <li><?php echo htmlspecialchars($val)?></li>\n              <?php } ?>\n            </ul>\n          </div>\n        </div>\n        <div data-role=\"feedback-form\" <?php echo $success ? \'style=\"display: none\"\' : \'\'?>>\n          <?php if ($proceed) { ?>\n              <?php if (!$key_is_invalid) { ?>\n                  <div class=\"form-group\">\n                    <label for=\"password_<?php echo (int)$Block->id?>\" class=\"control-label col-sm-3 col-md-2\"><?php echo PASSWORD?></label>\n                    <div class=\"col-sm-9 col-md-4\"><input type=\"password\" class=\"form-control\" name=\"password\" id=\"password_<?php echo (int)$Block->id?>\" /></div>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"password_confirm_<?php echo (int)$Block->id?>\" class=\"control-label col-sm-3 col-md-2\"><?php echo PASSWORD_CONFIRM?></label>\n                    <div class=\"col-sm-9 col-md-4\"><input type=\"password\" class=\"form-control\" name=\"password@confirm\" id=\"password_confirm_<?php echo (int)$Block->id?>\" /></div>\n                  </div>\n                  <div class=\"form-group\"><div class=\"col-sm-9 col-md-4 col-sm-offset-3 col-md-offset-2\"><button class=\"btn btn-primary\" type=\"submit\"><?php echo CHANGE?></button></div></div>\n              <?php } ?>\n          <?php } else { ?>\n              <div class=\"form-group\">\n                <label for=\"login_<?php echo (int)$Block->id?>\" class=\"control-label col-sm-3\"><?php echo ENTER_LOGIN_OR_EMAIL?></label>\n                <div class=\"col-sm-9 col-md-4\"><input type=\"text\" name=\"login\" class=\"form-control\" id=\"login_<?php echo (int)$Block->id?>\" /></div>\n              </div>\n              <div class=\"form-group\"><div class=\"col-sm-9 col-md-4 col-sm-offset-3\"><button class=\"btn btn-primary\" type=\"submit\"><?php echo SEND?></button></div></div>\n          <?php } ?>\n        </div>\n      </form>\n    </div>\n<?php } ?>\n',0),(55,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'goods_faq','<?php\nnamespace RAAS\\CMS;\n\nuse \\SOME\\Text;\nuse \\SOME\\HTTP;\n\nif ($Set) { ?>\n    <div class=\"goods-faq\">\n      <div class=\"goods-faq__list\">\n        <div class=\"goods-faq-list\">\n          <?php foreach ($Set as $row) { ?>\n              <div class=\"goods-faq-list__item\">\n                <div class=\"goods-faq-item\">\n                  <div class=\"goods-faq-item__text goods-faq-item__text_question\">\n                    <div class=\"goods-faq-item__title\">\n                      <span class=\"goods-faq-item__name\">\n                        <?php echo htmlspecialchars($row->name)?>\n                      </span>\n                      <?php\n                      $t = strtotime($row->date);\n                      if ($t <= 0) {\n                          $t = strtotime($row->post_date);\n                      }\n                      if ($t > 0) {\n                          ?>\n                          <span class=\"goods-faq-item__date\">\n                            <?php echo date(\'d\', $t) . \' \' . Text::$months[(int)date(\'m\', $t)] . \' \' . date(\'Y\', $t)?>\n                          </span>\n                      <?php } ?>\n                    </div>\n                    <div class=\"goods-faq-item__description\">\n                      <?php echo $row->description?>\n                    </div>\n                  </div>\n                  <?php if ($row->answer) { ?>\n                      <div class=\"goods-faq-item__text goods-faq-item__text_answer goods-faq-item__text_slider\">\n                        <div class=\"goods-faq-item__title\">\n                          <span class=\"goods-faq-item__name\">\n                            <?php echo ANSWER?>\n                          </span>\n                          <?php\n                          $t = strtotime($row->answer_date);\n                          if ($t <= 0) {\n                              $t = strtotime($row->modify_date);\n                          }\n                          if ($t > 0) {\n                              ?>\n                              <span class=\"goods-faq-item__date\">\n                                <?php echo date(\'d\', $t) . \' \' . Text::$months[(int)date(\'m\', $t)] . \' \' . date(\'Y\', $t)?>\n                              </span>\n                          <?php } ?>\n                        </div>\n                        <div class=\"goods-faq-item__description\">\n                          <div class=\"goods-faq-item__brief-description\">\n                            <?php echo Text::cuttext(html_entity_decode(strip_tags($row->answer), ENT_COMPAT | ENT_HTML5, \'UTF-8\'), 256, \'...\')?>\n                          </div>\n                          <div class=\"goods-faq-item__full-description\"><?php echo $row->answer?></div>\n                        </div>\n                        <div class=\"goods-faq-item__more\">\n                          <a href=\"#\" class=\"goods-faq-item__more-trigger\" data-show=\"<?php echo READ_ANSWER?>\" data-hide=\"<?php echo HIDE?>\">\n                            <?php echo READ_ANSWER?>\n                          </a>\n                        </div>\n                      </div>\n                  <?php } ?>\n                </div>\n              </div>\n          <?php } ?>\n        </div>\n      </div>\n      <script src=\"/js/goods-faq.js?v=<?php echo date(\'Y-m-d\', filemtime(\'js/goods-faq.js\'))?>\"></script>\n    </div>\n<?php } ?>',0),(56,2,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'goods_reviews','<?php\nnamespace RAAS\\CMS;\n\nuse \\SOME\\Text;\nuse \\SOME\\HTTP;\n\nif ($Set) { ?>\n    <div class=\"goods-reviews\">\n      <div class=\"goods-reviews__list\">\n        <div class=\"goods-reviews-list\">\n          <?php foreach ($Set as $row) { ?>\n              <div class=\"goods-reviews-list__item\">\n                <div class=\"goods-reviews-item\">\n                  <div class=\"goods-reviews-item__text goods-reviews-item__text_question\">\n                    <div class=\"goods-reviews-item__title\">\n                      <span class=\"goods-reviews-item__name\">\n                        <?php echo htmlspecialchars($row->name)?>\n                      </span>\n                      <?php\n                      $t = strtotime($row->date);\n                      if ($t <= 0) {\n                          $t = strtotime($row->post_date);\n                      }\n                      if ($t > 0) {\n                          ?>\n                          <span class=\"goods-reviews-item__date\">\n                            <?php echo date(\'d\', $t) . \' \' . Text::$months[(int)date(\'m\', $t)] . \' \' . date(\'Y\', $t)?>\n                          </span>\n                      <?php } ?>\n                    </div>\n                    <div class=\"goods-reviews-item__description\">\n                      <?php echo $row->description?>\n                    </div>\n                  </div>\n                  <?php if ($row->answer) { ?>\n                      <div class=\"goods-reviews-item__text goods-reviews-item__text_answer goods-reviews-item__text_slider\">\n                        <div class=\"goods-reviews-item__title\">\n                          <span class=\"goods-reviews-item__name\">\n                            <?php echo ANSWER?>\n                          </span>\n                          <?php\n                          $t = strtotime($row->answer_date);\n                          if ($t <= 0) {\n                              $t = strtotime($row->modify_date);\n                          }\n                          if ($t > 0) {\n                              ?>\n                              <span class=\"goods-reviews-item__date\">\n                                <?php echo date(\'d\', $t) . \' \' . Text::$months[(int)date(\'m\', $t)] . \' \' . date(\'Y\', $t)?>\n                              </span>\n                          <?php } ?>\n                        </div>\n                        <div class=\"goods-reviews-item__description\">\n                          <div class=\"goods-reviews-item__brief-description\">\n                            <?php echo Text::cuttext(html_entity_decode(strip_tags($row->answer), ENT_COMPAT | ENT_HTML5, \'UTF-8\'), 256, \'...\')?>\n                          </div>\n                          <div class=\"goods-reviews-item__full-description\"><?php echo $row->answer?></div>\n                        </div>\n                        <div class=\"goods-reviews-item__more\">\n                          <a href=\"#\" class=\"goods-reviews-item__more-trigger\" data-show=\"<?php echo READ_ANSWER?>\" data-hide=\"<?php echo HIDE?>\">\n                            <?php echo READ_ANSWER?>\n                          </a>\n                        </div>\n                      </div>\n                  <?php } ?>\n                </div>\n              </div>\n          <?php } ?>\n        </div>\n      </div>\n      <script src=\"/js/goods-reviews.js?v=<?php echo date(\'Y-m-d\', filemtime(\'js/goods-reviews.js\'))?>\"></script>\n    </div>\n<?php } ?>',0),(57,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0,'hidden_props','<?php\n/**\n * Скрытые свойства\n * @return array<string>\n */\nreturn [\n    \'images\',\n    \'brief\',\n    \'videos\',\n    \'videos_url\',\n    \'files\',\n    \'onmain\',\n    \'article\',\n    \'price\',\n    \'price_old\',\n    \'available\',\n    \'min\',\n    \'step\'\n];\n',0),(58,1,'2023-12-04 12:35:50','2024-04-04 10:06:56',1,1,'cart_interface','<?php\n/**\n * Стандартный интерфейс корзины\n * @param Block_Cart $Block Текущий блок <pre><code>Block_Cart(\n *     \'additionalParams\' => [\n *         \'cdek\' =>? [\n *             \'authLogin\' => string Логин\n *             \'secure\' => string Пароль,\n *             \'senderCityId\' => int ID# города отправителя в системе СДЭК,\n *             \'pickupTariff\' => int ID# тарифа самовывоза в системе СДЭК\n *             \'deliveryTariff\' => int ID# тарифа доставки в системе СДЭК\n *         ] Настройки доставки СДЭК,\n *     ],\n *     \'russianPost\' =>? [\n *         \'login\' => string Логин,\n *         \'password\' => string Пароль,\n *         \'token\' => string Токен,\n *     ], Настройки доставки Почты России,\n *     \'minOrderSum\' =>? int Минимальная сумма заказа,\n *     \'bindUserBy\' =>? string[] Привязка заказа к существующему пользователю -\n *         перечисление URN полей\n *     \'createUserBlockId\' =>? int ID# блока регистрации для создания\n *         нового пользователя, если не удалось найти существующего\n *         (только при указании bindUserBy)\n * )</code></pre>\n * @param Page $Page Текущая страница\n */\nnamespace RAAS\\CMS\\Shop;\n\nuse SOME\\Text;\nuse RAAS\\Application;\nuse RAAS\\Controller_Frontend as RAASControllerFrontend;\nuse RAAS\\CMS\\Material;\nuse RAAS\\CMS\\Material_Type;\nuse RAAS\\CMS\\Page;\nuse RAAS\\CMS\\User;\n\n$cartType = new Cart_Type((int)$Block->cart_type);\n$user = RAASControllerFrontend::i()->user;\n$cart = new Cart($cartType, $user);\n$weight = $cart->weight;\n$sizes = $cart->sizes;\n$_POST[\'weight\'] = $weight;\n\n$interface = new CartInterface($Block, $Page, $_GET, $_POST, $_COOKIE, $_SESSION, $_SERVER, $_FILES);\n$cities = include Application::i()->baseDir . \'/cities.brief.php\';\n\n/**\n * Получает тарифы на доставку СДЭК\n * @param string $cityURN URN города\n * @param float $weight Вес, кг\n * @param int[] $sizes Размеры (ДxШxВ) в см\n * @return array|null <pre><code>array<\n *     \'pickup\'|\'delivery\'[] Доставка или самовывоз => array<\n *         string[] ID# тарифа => [\n *             \'id\' => string ID# тарифа,\n *             \'isDelivery\' => bool true - доставка, false - самовывоз,\n *             \'price\' => float Стоимость доставки,\n *             \'dateFrom\' ?=> string Минимальная дата доставки (ГГГГ-ММ-ДД),\n *             \'dateTo\' ?=> string Максимальная дата доставки (ГГГГ-ММ-ДД),\n *         ]\n *     >\n * ></code></pre>, либо null, если не найдено\n */\n$getCDEKTariffs = function ($cityURN, $weight, array $sizes) use ($Block, $cities) {\n    $sessionVar = implode(\'x\', array_merge([trim($cityURN)], $sizes, [$weight]));\n    $sessionTime = (int)$_SESSION[\'cdekTariffs\'][$sessionVar][\'timestamp\'];\n    if (Application::i()->debug || ($sessionTime < time() - 600)) {\n        $result = [];\n        $params = $Block->additionalParams[\'cdek\'];\n\n        if (!isset($cities[$cityURN][\'cdekCityId\']) ||\n            !$params[\'authLogin\'] ||\n            !$params[\'secure\'] ||\n            !$params[\'senderCityId\']\n        ) {\n            return null;\n        }\n\n        $response = null;\n        $authRequest = [\n            \'grant_type\' => \'client_credentials\',\n            \'client_id\' => $params[\'authLogin\'],\n            \'client_secret\' => $params[\'secure\'],\n        ];\n        $ch = curl_init(\'https://api.cdek.ru/v2/oauth/token\');\n        curl_setopt($ch, CURLOPT_POST, 1);\n        curl_setopt($ch, CURLOPT_POSTFIELDS, $authRequest);\n        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);\n        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n        $authResponse = curl_exec($ch);\n        $authResponse = (array)json_decode($authResponse, true);\n        if ($authResponse[\'access_token\']) {\n            $token = $authResponse[\'access_token\'];\n        }\n\n        if (!$token) {\n            return null;\n        }\n\n        $request = [\n            \'from_location\' => [\'code\' => (int)$params[\'senderCityId\']],\n            \'to_location\' => [\'code\' => (int)$cities[$cityURN][\'cdekCityId\']],\n            \'currency\' => 1, // Рубль\n            \'packages\' => [[\n                \'weight\' => (int)($weight * 1000),\n                \'length\' => (int)$sizes[0],\n                \'width\' => (int)$sizes[1],\n                \'height\' => (int)$sizes[2],\n            ]],\n        ];\n        $ch = curl_init(\'https://api.cdek.ru/v2/calculator/tarifflist\');\n        curl_setopt($ch, CURLOPT_POST, 1);\n        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($request));\n        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);\n        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n        curl_setopt($ch, CURLOPT_HTTPHEADER, [\n            \'Content-Type: application/json\',\n            \'Authorization: Bearer \' . $token\n        ]);\n        $response = curl_exec($ch);\n        $response = (array)json_decode($response, true);\n\n        if (!$response[\'tariff_codes\']) {\n            return null;\n        }\n        $response = $response[\'tariff_codes\'];\n\n        foreach ($response as $tariff) {\n            switch ($tariff[\'tariff_code\']) {\n                case $params[\'pickupTariff\']:\n                    $tariffType = \'pickup\';\n                    break;\n                case $params[\'deliveryTariff\']:\n                    $tariffType = \'delivery\';\n                    break;\n                default:\n                    continue 2;\n                    break;\n            }\n            $tariffSum = (float)$tariff[\'delivery_sum\'];\n            if ($params[\'priceRatio\'] ?? \'\') {\n                if (stristr($params[\'priceRatio\'], \'%\')) {\n                    $tariffSum *= (100 + (float)$params[\'priceRatio\']) / 100;\n                } else {\n                    $tariffSum += (float)$params[\'priceRatio\'];\n                }\n            }\n            $tariffSum = ceil($tariffSum);\n            $result[$tariffType][trim($tariff[\'tariff_code\'])] = [\n                \'id\' => trim($tariff[\'tariff_code\']),\n                \'isDelivery\' => ($tariffType == \'delivery\'),\n                \'price\' => $tariffSum,\n                \'dateFrom\' => date(\'Y-m-d\', time() + (86400 * (1 + $tariff[\'period_min\']))),\n                \'dateTo\' => date(\'Y-m-d\', time() + (86400 * (1 + $tariff[\'period_max\']))),\n            ];\n        }\n        $sessionVal = [\'data\' => $result, \'timestamp\' => time()];\n        $_SESSION[\'cdekTariffs\'][$sessionVar] = $sessionVal;\n    }\n    return $_SESSION[\'cdekTariffs\'][$sessionVar][\'data\'];\n};\n\n\n/**\n * Получает тарифы на доставку Почтой России\n * @param string $postalCode Индекс\n * @param float $weight Вес, кг\n * @param int[] $sizes Размеры (ДxШxВ) в см\n * @param float $sum Сумма заказа\n * @return array|null <pre><code>array<\n *     \'pickup\'|\'delivery\'[] Доставка или самовывоз => array<\n *         string[] ID# тарифа => [\n *             \'id\' => string ID# тарифа,\n *             \'isDelivery\' => bool true - доставка, false - самовывоз,\n *             \'price\' => float Стоимость доставки,\n *             \'dateFrom\' ?=> string Минимальная дата доставки (ГГГГ-ММ-ДД),\n *             \'dateTo\' ?=> string Максимальная дата доставки (ГГГГ-ММ-ДД),\n *         ]\n *     >\n * ></code></pre>, либо null, если не найдено\n */\n$getRussianPostTariffs = function ($postalCode, $weight, array $sizes, $sum) use ($Block) {\n    $sessionArr = [trim($postalCode), $weight];\n    $sessionVar = implode(\'x\', $sessionArr);\n    $sessionTime = (int)$_SESSION[\'russianPostTariffs\'][$sessionVar][\'timestamp\'];\n    if (Application::i()->debug || ($sessionTime < time() - 600)) {\n        $result = [];\n        $params = $Block->additionalParams[\'russianpost\'];\n\n        $baseUrl = \'https://tariff.pochta.ru/v2/calculate/tariff/delivery\';\n        $baseRequestParams = [\n            \'json\' => 1,\n            \'from\' => $params[\'senderIndex\'],\n            \'to\' => $postalCode,\n            \'weight\' => $weight * 1000,\n            \'group\' => 0, // Единичное отправление (0)\n            \'service\' => implode(\',\', (array)$params[\'services\']), // Пакет СМС уведомлений отправителю при единичном приеме (41), Пакет СМС уведомлений получателю при единичном приеме (42)\n            \'closed\' => 0, // Расчет при запрете доставки на дату расчета (closed): нет (не используется).\n        ];\n\n        foreach ([\'pickup\', \'delivery\'] as $tariffURN) {\n            // 23030 - Посылка онлайн обыкновенная\n            if ($tariffId = $params[$tariffURN . \'Tariff\'] ?? null) {\n                $request = $baseRequestParams;\n                $request[\'object\'] = (int)$tariffId;\n                $url = $baseUrl . \'?\' . http_build_query($request);\n                $response = file_get_contents($url);\n                $response = (array)json_decode($response, true);\n                // var_dump($url, $response); exit;\n                if (!$response) {\n                    continue;\n                }\n\n                $tariffSum = (float)$response[\'pay\'] / 100;\n                if ($params[\'priceRatio\'] ?? \'\') {\n                    if (stristr($params[\'priceRatio\'], \'%\')) {\n                        $tariffSum *= (100 + (float)$params[\'priceRatio\']) / 100;\n                    } else {\n                        $tariffSum += (float)$params[\'priceRatio\'];\n                    }\n                }\n                $tariffSum = ceil($tariffSum);\n                $tariff = [\n                    \'id\' => $tariffId,\n                    \'isDelivery\' => ($tariffURN == \'delivery\'),\n                    \'price\' => $tariffSum,\n                ];\n                if ($response[\'delivery\'][\'min\'] ?? 0) {\n                    $tariff[\'dateFrom\'] = date(\'Y-m-d\', time() + (86400 * (1 + $response[\'delivery\'][\'min\'])));\n                }\n                if ($response[\'delivery\'][\'deadline\'] ?? null) {\n                    $tariff[\'dateTo\'] = date(\'Y-m-d\', strtotime($response[\'delivery\'][\'deadline\']) + 86400);\n                }\n                $result[$tariffURN][$tariffId] = $tariff;\n            }\n        }\n        $sessionVal = [\'data\' => $result, \'timestamp\' => time()];\n        $_SESSION[\'russianPostTariffs\'][$sessionVar] = $sessionVal;\n    }\n    return $_SESSION[\'russianPostTariffs\'][$sessionVar][\'data\'];\n};\n\n\n/**\n * Получает тарифы на собственную доставку\n * @param string $city Наименование города\n * @param float $weight Вес, кг\n * @param int[] $sizes Размеры (ДxШxВ) в см\n * @param float $sum Сумма заказа\n * @param Material $deliveryMaterial Материал доставки\n * @return array|null <pre><code>array<\n *     \'pickup\'|\'delivery\'[] Доставка или самовывоз => array<\n *         string[] ID# тарифа => [\n *             \'id\' => string ID# тарифа,\n *             \'isDelivery\' => bool true - доставка, false - самовывоз,\n *             \'price\' => float Стоимость доставки,\n *             \'dateFrom\' ?=> string Минимальная дата доставки (ГГГГ-ММ-ДД),\n *             \'dateTo\' ?=> string Максимальная дата доставки (ГГГГ-ММ-ДД),\n *         ]\n *     >\n * ></code></pre>, либо null, если не найдено\n */\n$getSelfTariffs = function ($city, $weight, array $sizes, $sum, $deliveryMaterial) use ($Block) {\n    $sessionArr = array_merge([trim($city)], $sizes, [$weight, $sum]);\n    $sessionVar = implode(\'x\', $sessionArr);\n    $sessionTime = (int)$_SESSION[\'selfTariffs\'][$sessionVar][\'timestamp\'];\n    if (Application::i()->debug || ($sessionTime < time() - 600)) {\n        $result = [];\n\n        $companyMaterialType = Material_Type::importByURN(\'company\');\n        $companies = Material::getSet([\n            \'where\' => \"pid = \" . (int)$companyMaterialType->id,\n            \'orderBy\' => \"NOT priority, priority, name\",\n        ]);\n        $companies = array_filter($companies, function ($x) use ($city) {\n            return trim(mb_strtolower($x->city)) == trim(mb_strtolower($city));\n        });\n        $companies = array_values($companies);\n\n        if (!$companies) {\n            return null;\n        }\n\n        $result[\'pickup\'][\'\'] = [\n            \'id\' => \'\',\n            \'isDelivery\' => false,\n            \'price\' => 0,\n        ];\n\n        if ($deliveryMaterial->id) {\n            $deliverySum = 0;\n            if (!(float)$deliveryMaterial->min_sum || ((float)$deliveryMaterial->min_sum > $sum)) {\n                $deliverySum = ceil((float)$deliveryMaterial->price);\n            }\n            $result[\'delivery\'][\'\'] = [\n                \'id\' => \'\',\n                \'isDelivery\' => true,\n                \'price\' => $deliverySum,\n                \'dateFrom\' => date(\'Y-m-d\', time() + 86400),\n                \'dateTo\' => date(\'Y-m-d\', time() + 86400),\n            ];\n        }\n\n        $sessionVal = [\'data\' => $result, \'timestamp\' => time()];\n        $_SESSION[\'selfTariffs\'][$sessionVar] = $sessionVal;\n    }\n    return $_SESSION[\'selfTariffs\'][$sessionVar][\'data\'];\n};\n\n\n/**\n * Получает список собственных пунктов выдачи\n * @param string $city Наименование города\n * @return array <pre><code>array<[\n *     \'id\' => string ID# пункта выдачи,\n *     \'name\' => string Наименование пункта выдачи,\n *     \'address\' => string Адрес пункта выдачи\n *     \'description\' => string Подсказка к адресу,\n *     \'lat\' => float Широта,\n *     \'lon\' => float Долгота,\n *     \'schedule\' ?=> string Время работы,\n *     \'phones\' ?=> string[] Телефоны (Последние 10 цифр),\n *     \'images\' ?=> string[] URL картинок,\n * ]></code></pre>\n */\n$getSelfPoints = function ($city) {\n    $companyMaterialType = Material_Type::importByURN(\'company\');\n    $companies = Material::getSet([\n        \'where\' => \"pid = \" . (int)$companyMaterialType->id,\n        \'orderBy\' => \"NOT priority, priority, name\",\n    ]);\n    $companies = array_filter($companies, function ($x) use ($city) {\n        return trim(mb_strtolower($x->city)) == trim(mb_strtolower($city)) &&\n            (float)$x->lat &&\n            (float)$x->lon;\n    });\n    $companies = array_values($companies);\n    $result = [];\n    foreach ($companies as $company) {\n        $office = $company->office;\n        $result[] = [\n            \'id\' => trim((int)$company->id),\n            \'name\' => \'Офис продаж \' . $company->name,\n            \'address\' => $company->street_address\n                . ($office ? \', \' . $office : \'\'),\n            \'description\' => \'\',\n            \'lat\' => (float)$company->lat,\n            \'lon\' => (float)$company->lon,\n            \'schedule\' => trim($company->schedule),\n            \'phones\' => array_map(function ($x) {\n                return Text::beautifyPhone($x, 10);\n            }, (array)$company->fields[\'phone\']->getValues()),\n            \'serviceURN\' => \'\',\n        ];\n    }\n    return $result;\n};\n\n\n/**\n * Функция расчета дополнительных пунктов для корзины\n * @param Cart $cart Корзина\n * @param array $post POST-данные\n * @param User $user Пользователь\n * @return array <pre>[\n *     \'items\' => array<CartItem>,\n *     string[] => mixed Дополнительные данные\n * ]</pre>\n */\n$getAdditionals = function (\n    Cart $cart,\n    array $post = [],\n    User $user = null\n) use (\n    &$getCDEKTariffs,\n    &$getRussianPostTariffs,\n    &$getSelfTariffs,\n    &$getSelfPoints\n) {\n    $result = [];\n\n    $sum = (float)$cart->sum;\n    $result[\'weight\'] = $_POST[\'weight\'] = $post[\'weight\'] = $weight = ceil($cart->weight * 1000) / 1000;\n    $result[\'sizes\'] = $sizes = $cart->sizes;\n    $_POST[\'sizes\'] = $post[\'sizes\'] = implode(\'x\', $sizes);\n    $sumForDiscount = 0;\n    foreach ($cart->items as $cartItem) {\n        if ($cartItem->amount) {\n            $material = $cartItem->material;\n            if ((float)$material->price_old <= (float)$material->price) {\n                $sumForDiscount += (float)$cartItem->sum;\n            }\n        }\n    }\n\n    $discountSum = 0;\n    if ($post[\'promo\']) {\n        $promoMaterialType = Material_Type::importByURN(\'discount\');\n        $sqlQuery = \"SELECT pid FROM cms_data WHERE fid = ? AND value = ?\";\n        $sqlBind = [\n            (int)$promoMaterialType->fields[\'code\']->id,\n            $post[\'promo\'],\n        ];\n        $sqlResult = Material::_SQL()->getvalue([$sqlQuery, $sqlBind]);\n        if ((int)$sqlResult) {\n            $card = new Material((int)$sqlResult);\n            $discountSum = ceil($sumForDiscount * $card->discount / -100);\n            $result[\'discount\'] = [\n                \'id\' => (int)$card->id,\n                \'name\' => $card->name,\n                \'discount\' => $card->discount,\n                \'price\' => $discountSum,\n            ];\n            $result[\'items\'][] = new CartItem([\n                \'id\' => (int)$card->id,\n                \'name\' => $card->name,\n                \'realprice\' => (float)$discountSum,\n                \'additional\' => [\'type\' => \'discount\'],\n            ]);\n        } else {\n            $result[\'discount\'][\'error\'] = true;\n        }\n    }\n\n    if ($post[\'cityURN\'] && $post[\'city\']) {\n        $cityURN = $post[\'cityURN\'];\n        if (!Application::i()->debug && isset($_SESSION[\'citiesData@\' . $cityURN])) {\n            $cityData = $_SESSION[\'citiesData@\' . $cityURN];\n        } else {\n            $citiesJSON = include Application::i()->baseDir . \'/cities.php\';\n            $cityData = $citiesJSON[$cityURN];\n            $_SESSION[\'citiesData@\' . $cityURN] = $cityData;\n        }\n        $points = $cityData[\'points\'] ?? [];\n        $points = array_values(array_filter(\n            $points,\n            function ($x) use ($sizes, $weight) {\n                if ($x[\'sizes\']) {\n                    $selfSizes = $sizes;\n                    sort($selfSizes);\n                    for ($i = 0; $i < 3; $i++) {\n                        if ($selfSizes[$i] >= $x[\'sizes\'][$i]) {\n                            return false;\n                        }\n                    }\n                }\n                if ($x[\'weight\'] && $weight > $x[\'weight\']) {\n                    return false;\n                }\n                return true;\n            }\n        ));\n\n        // Указан город, найдем варианты доставки\n        $sumForDelivery = $cart->sum + $discountSum;\n        $deliveryMaterialType = Material_Type::importByURN(\'delivery\');\n        $deliveryMaterials = Material::getSet([\n            \'where\' => [\"vis\", \"pid = \" . (int)$deliveryMaterialType->id],\n            \'orderBy\' => \"NOT priority, priority, name\",\n        ]);\n        $affectedServicesURNs = [];\n        $deliveries = $tariffs = $payments = [];\n        $selfDelivery = null;\n        foreach ($deliveryMaterials as $deliveryMaterial) {\n            $delivery = [\n                \'id\' => (int)$deliveryMaterial->id,\n                \'name\' => trim($deliveryMaterial->brief ?: $deliveryMaterial->name),\n                \'description\' => trim($deliveryMaterial->description),\n                \'fullName\' => trim($deliveryMaterial->name),\n                \'isDelivery\' => (bool)(int)$deliveryMaterial->delivery,\n                \'serviceURN\' => trim($deliveryMaterial->service_urn),\n            ];\n            $citiesBeautified = array_map(function ($x) {\n                return Text::beautify($x);\n            }, (array)$deliveryMaterial->cities);\n            $delivery[\'citiesBeautified\'] = $citiesBeautified;\n            if ($citiesBeautified && !in_array(Text::beautify($post[\'city\']), $citiesBeautified)) {\n                continue;\n            }\n            $affectedServicesURNs[$delivery[\'serviceURN\']] = $delivery[\'serviceURN\'];\n            $deliveries[trim($deliveryMaterial->id)] = $delivery;\n            if (!$delivery[\'serviceURN\'] && $delivery[\'isDelivery\']) {\n                $selfDelivery = $deliveryMaterial;\n            }\n        }\n        if (isset($affectedServicesURNs[\'\'])) {\n            $tariffs[\'\'] = $getSelfTariffs($post[\'city\'], $weight, $sizes, $sumForDelivery, $selfDelivery);\n            $points = array_merge($points, $getSelfPoints($post[\'city\']));\n        }\n        if ($affectedServicesURNs[\'cdek\']) {\n            $tariffs[\'cdek\'] = $getCDEKTariffs($post[\'cityURN\'], $weight, $sizes);\n        }\n        if ($affectedServicesURNs[\'russianpost\']) {\n            $postalCode = trim($post[\'post_code\']) ?: $cityData[\'postalCode\'];\n            $tariffs[\'russianpost\'] = $getRussianPostTariffs($postalCode, $weight, $sizes, $sumForDelivery);\n        }\n        $newDeliveries = [];\n        foreach ($deliveries as $deliveryId => $delivery) {\n            if ($matchingTariffs = $tariffs[$delivery[\'serviceURN\']][$delivery[\'isDelivery\'] ? \'delivery\' : \'pickup\']) {\n                foreach ($matchingTariffs as $tariffId => $tariff) {\n                    if (isset($tariff[\'price\'])) {\n                        $delivery[\'tariffId\'] = $tariff[\'id\'];\n                        $delivery[\'price\'] = (float)$tariff[\'price\'];\n                        if ($tariff[\'dateFrom\']) {\n                            $delivery[\'dateFrom\'] = $tariff[\'dateFrom\'];\n                        }\n                        if ($tariff[\'dateTo\']) {\n                            $delivery[\'dateTo\'] = $tariff[\'dateTo\'];\n                        }\n                    } else {\n                        $delivery[\'error\'] = true;\n                    }\n                }\n            } else {\n                $delivery[\'error\'] = true;\n            }\n            $newDeliveries[$deliveryId] = $delivery;\n            $result[\'delivery\'][\'methods\'][] = $delivery;\n        }\n        $deliveries = $newDeliveries;\n        $result[\'delivery\'][\'points\'] = $points;\n\n        if ($post[\'delivery\']) {\n            if ($delivery = $deliveries[$post[\'delivery\']]) {\n                $result[\'delivery\'][\'tariffId\'] = $delivery[\'tariffId\'];\n                if ($delivery[\'dateFrom\']) {\n                    $result[\'delivery\'][\'dateFrom\'] = $delivery[\'dateFrom\'];\n                }\n                if ($delivery[\'dateTo\']) {\n                    $result[\'delivery\'][\'dateTo\'] = $delivery[\'dateTo\'];\n                }\n                if (isset($delivery[\'price\'])) {\n                    $result[\'delivery\'][\'price\'] = $delivery[\'price\'];\n                }\n                if (($delivery[\'price\'] || $delivery[\'isDelivery\']) && !($delivery[\'error\'] ?? false)) {\n                    $result[\'items\'][] = new CartItem([\n                        \'id\' => $delivery[\'id\'],\n                        \'name\' => \'Доставка\',\n                        \'realprice\' => (float)$delivery[\'price\'],\n                        \'additional\' => [\'type\' => \'delivery\'],\n                    ]);\n                }\n                if ($delivery[\'error\']) {\n                    $result[\'delivery\'][\'error\'] = true;\n                }\n            } else {\n                $result[\'delivery\'][\'error\'] = true;\n            }\n            $paymentMaterialType = Material_Type::importByURN(\'payment\');\n            $paymentMaterials = Material::getSet([\n                \'where\' => [\"vis\", \"pid = \" . (int)$paymentMaterialType->id],\n                \'orderBy\' => \"NOT priority, priority, name\",\n            ]);\n            $paymentMaterials = array_filter(\n                $paymentMaterials,\n                function ($x) use ($post) {\n                    $paymentDeliveries = array_map(function ($x) {\n                        return (int)$x->id;\n                    }, (array)$x->delivery);\n                    $paymentDeliveries = array_values(array_filter($paymentDeliveries, \'trim\'));\n                    if ($paymentDeliveries &&\n                        !in_array($post[\'delivery\'], $paymentDeliveries)\n                    ) {\n                        return false;\n                    }\n                    return true;\n                }\n            );\n            foreach ($paymentMaterials as $paymentMaterial) {\n                $commission = 0;\n                if ($paymentCommission = trim($paymentMaterial->commission)) {\n                    if (stristr($paymentCommission, \'%\')) {\n                        $commission = ceil($sum * (int)$paymentCommission / 100);\n                    } else {\n                        $commission = (int)$paymentCommission;\n                    }\n                }\n                $payment = [\n                    \'id\' => (int)$paymentMaterial->id,\n                    \'name\' => trim($paymentMaterial->name),\n                    \'description\' => trim($paymentMaterial->description),\n                    \'epay\' => (bool)(int)$paymentMaterial->epay,\n                    \'price\' => $commission,\n                ];\n                if ($commission) {\n                    $payment[\'price\'] = $commission;\n                }\n                $payments[trim($payment[\'id\'])] = $payment;\n                $result[\'payment\'][\'methods\'][] = $payment;\n            }\n            if ($post[\'payment\']) {\n                if ($payment = $payments[$post[\'payment\']]) {\n                    if ($payment[\'price\']) {\n                        $result[\'payment\'][\'price\'] = $payment[\'price\'];\n                        $result[\'items\'][] = new CartItem([\n                            \'id\' => $payment[\'id\'],\n                            \'name\' => View_Web::i()->_(\'COMMISSION\'),\n                            \'realprice\' => (float)$payment[\'price\'],\n                            \'additional\' => [\'type\' => \'payment\'],\n                        ]);\n                    }\n                }\n            }\n        }\n    }\n\n    return $result;\n};\n\n$interface->additionalsCallback = $getAdditionals;\n\n$delivery = new Material($_POST[\'delivery\']);\n$isDelivery = (bool)(int)$delivery->delivery;\n\n$interface->conditionalRequiredFields = [\n    \'delivery\' => function ($field, $post) {\n        return !$post[\'quickorder\'];\n    },\n    \'payment\' => function ($field, $post) {\n        return !$post[\'quickorder\'];\n    },\n    \'post_code\' => function ($field, $post) use ($delivery, $isDelivery) {\n        return $delivery->id &&\n            $isDelivery &&\n            in_array($delivery->service_urn, [\'russianpost\']);\n    },\n    \'region\' => function ($field, $post) {\n        return !$post[\'quickorder\'];\n    },\n    \'city\' => function ($field, $post) {\n        return !$post[\'quickorder\'];\n    },\n    \'pickup_point\' => function ($field, $post) {\n        return $delivery->id && !$isDelivery && !$post[\'quickorder\'];\n    },\n    \'street\' => function ($field, $post) {\n        return $delivery->id && $isDelivery && !$post[\'quickorder\'];\n    },\n    \'house\' => function ($field, $post) {\n        return $delivery->id && $isDelivery && !$post[\'quickorder\'];\n    },\n    \'last_name\' => function ($field, $post) {\n        return !$post[\'quickorder\'];\n    },\n    \'first_name\' => function ($field, $post) {\n        return !$post[\'quickorder\'];\n    },\n];\n\n$result = $interface->process();\nif ((int)$Block->additionalParams[\'minOrderSum\']) {\n    $result[\'minOrderSum\'] = (int)$Block->additionalParams[\'minOrderSum\'];\n}\n$result[\'cities\'] = $cities;\nreturn $result;\n',0),(59,1,'2023-12-04 12:35:50','2024-04-04 10:06:56',1,1,'__raas_shop_compare_interface','<?php\n/**\n * Стандартный интерфейс сравнения\n * @param Block_Cart $Block Текущий блок\n * @param Page $Page Текущая страница\n */\nnamespace RAAS\\CMS\\Shop;\n\nuse RAAS\\CMS\\Page;\n\n$interface = new CompareInterface(\n    $Block,\n    $Page,\n    $_GET,\n    $_POST,\n    $_COOKIE,\n    $_SESSION,\n    $_SERVER,\n    $_FILES\n);\nreturn $interface->process();\n',1),(60,1,'2023-12-04 12:35:50','2024-04-04 10:06:56',1,1,'__raas_shop_goods_comments_interface','<?php\r\n/**\r\n * Стандартный интерфейс комментариев к товарам\r\n * @param Block_Material $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS\\Shop;\r\n\r\nuse RAAS\\CMS\\Block_Material;\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new GoodsCommentsInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(61,1,'2023-12-04 12:35:50','2024-04-04 10:06:56',1,1,'__raas_shop_spec_interface','<?php\r\n/**\r\n * Стандартный интерфейс спецпредложений\r\n * @param Block_Material $Block Текущий блок\r\n * @param Page $Page Текущая страница\r\n */\r\nnamespace RAAS\\CMS\\Shop;\r\n\r\nuse RAAS\\CMS\\Block_Material;\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new SpecInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\nreturn $interface->process();\r\n',1),(62,1,'2023-12-04 12:35:51','2024-04-04 10:06:56',1,1,'sberbank_interface','<?php\r\n/**\r\n * Интерфейс Сбербанка\r\n * @param Block_Cart $Block Текущий блок\r\n * @param Page $Page Текушая страница\r\n * @param Order $Item текущий заказ\r\n */\r\nnamespace RAAS\\CMS\\Shop;\r\n\r\nuse RAAS\\CMS\\Page;\r\n\r\n$interface = new SberbankInterface(\r\n    $Block,\r\n    $Page,\r\n    $_GET,\r\n    $_POST,\r\n    $_COOKIE,\r\n    $_SESSION,\r\n    $_SERVER,\r\n    $_FILES\r\n);\r\n$sberbankOut = $interface->process($Item);\r\nif (isset($OUT)) {\r\n    $OUT = array_merge((array)$OUT, $sberbankOut);\r\n}\r\nreturn $sberbankOut;\r\n',0);
/*!40000 ALTER TABLE `cms_snippets` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2024-04-04 10:40:30
